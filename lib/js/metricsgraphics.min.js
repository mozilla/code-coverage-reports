!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof exports?module.exports=e(require("d3")):t.MG=e(t.d3)}(this,function(E){"use strict";var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function k(){return"undefined"!=typeof jQuery||"undefined"!=typeof $}function i(t,e){return t[e.x_accessor]>=e.processed.min_x&&t[e.x_accessor]<=e.processed.max_x&&t[e.y_accessor]>=e.processed.min_y&&t[e.y_accessor]<=e.processed.max_y}function u(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t){var e=t.map(function(t){return!0===u(t)&&0<t.length});return E.sum(e)===t.length}function a(t){var e=t.map(function(t){return!0==(e=t,"[object Object]"===Object.prototype.toString.call(e));var e});return E.sum(e)===t.length}function e(t){return u(e=t)&&0===e.length||a(t);var e}function w(t){return t.height-t.bottom}function v(t){return w(t)-t.buffer}function M(t){return t.top}function b(t){return M(t)+t.buffer}function G(t){return t.left}function Y(t){return G(t)+t.buffer}function A(t){return t.width-t.right}function P(t){return A(t)-t.buffer}function _(t){t.exit().remove()}function D(t,e){t.selectAll(e).remove()}function S(t,e){return t.append("g").classed(e,!0)}function r(t,e){var r=O(t.target),n=h(t.data),a=r.selectAll("line."+e).data(n);return a.enter().append("line").attr("class",e).attr("opacity",.3),_(a),_(a),a}function m(t,e,r){e.color_accessor?(t.attr("stroke",e.scalefns.colorf),t.classed(r,!1)):(t.attr("stroke",null),t.classed(r,!0))}function l(t,e){e&&t.attr({dy:0,transform:function(){var t=E.select(this);return"rotate("+e+" "+t.attr("x")+","+t.attr("y")+")"}})}function g(t){if(!(t=t.node()))return!1;for(var e=0;e<t.length;e++)if(o(t[e],t))return!0;return!1}function o(t,e){for(var r=t.getBoundingClientRect(),n=0;n<e.length;n++)if(e[n]!=t){var a=e[n].getBoundingClientRect();if(r.top===a.top&&!(a.left>r.right||a.right<r.left))return!0}return!1}function s(t,e){var r=h(t.data);return"string"==typeof(r=r[0][t[e+"_accessor"]])?"categorical":"numerical"}function O(t){return E.select(t).select("svg")}function h(t){var e=[];return e.concat.apply(e,t)}function z(t){if("string"==typeof t)return F(t);if(t instanceof window.HTMLElement){var e=t.getAttribute("data-mg-uid");return e||(void 0===MG._next_elem_id&&(MG._next_elem_id=0),e="mg-"+MG._next_elem_id++,t.setAttribute("data-mg-uid",e)),e}return console.warn("The specified target should be a string or an HTMLElement.",t),F(t)}function F(t){return t.replace(/[^a-zA-Z0-9 _-]+/g,"").replace(/ +?/g,"")}function f(t,e){return Number(E.select(t).style(e).replace(/px/g,""))}function d(t){return f(t,"width")}("undefined"==typeof window?global:window).MG={version:"2.11"},MG.convert={},MG.convert.date=function(t,e,r){r=void 0===r?"%Y-%m-%d":r;var n=E.timeParse(r);return t=t.map(function(t){return t[e]=n(t[e].trim()),t})},MG.convert.number=function(t,e){return t=t.map(function(t){return t[e]=Number(t[e]),t})},MG.time_format=function(t,e){return t?E.utcFormat(e):E.timeFormat(e)};var t=function(t,e,r){var n={};if(null===t)return t;if(Array.prototype.forEach&&t.forEach===Array.prototype.forEach)t.forEach(e,r);else if(t.length===+t.length){for(var a=0,o=t.length;a<o;a++)if(e.call(r,t[a],a,t)===n)return}else for(var i in t)if(e.call(r,t[i],i,t)===n)return;return t};function p(r){return t(Array.prototype.slice.call(arguments,1),function(t){if(t)for(var e in t)void 0===r[e]&&(r[e]=t[e])}),r}function x(r){return Object.keys(r).reduce(function(t,e){return t[e]=r[e][0],t},{})}function y(t,e){if(!u(MG.options[t]))return!1;var r=MG.options[t][1];return!r||function e(r,n){return null==n||("string"==typeof r?"[]"===r.substr(-2)?!!u(n)&&n.every(function(t){return e(r.slice(0,-2),t)}):(void 0===n?"undefined":c(n))===r||n===r||0===r.length||"array"===r&&u(n):"function"==typeof r?n===r||n instanceof r:u(r)&&!!~r.findIndex(function(t){return e(t,n)}))}(r,e)}function C(t){return"[object Date]"===Object.prototype.toString.call(t)}function T(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}function R(t){return"[object Function]"===Object.prototype.toString.call(t)}function j(t,e){var r,n=[],a=[];for(r=0;r<e.length;r++)n[e[r]]=!0;for(r=0;r<t.length;r++)n[t[r]]||a.push(t[r]);return a}function L(t,e){console.warn("Deprecation: "+t+(e?". This feature will be removed in "+e+".":" the near future.")),console.trace()}function X(t,e,r){var n,a=0;for(t.textContent=e,n=t.getBBox();n.width>r&&(t.textContent=e.slice(0,--a)+"...",n=t.getBBox(),"..."!==t.textContent););}function N(t){var e=O(t.target);if(e.select(".mg-header").remove(),t.target&&t.title){var r=e.insert("text").attr("class","mg-header").attr("x",t.center_title_full_width?t.width/2:(t.width+t.left-t.right)/2).attr("y",t.title_y_position).attr("text-anchor","middle").attr("dy","0.55em");if(r.append("tspan").attr("class","mg-chart-title").text(t.title),t.show_tooltips&&t.description&&k()){r.append("tspan").attr("class","mg-chart-description").attr("dx","0.3em").text("ÔÅô");var n=$(r.node());n.popover({html:!0,animation:!1,placement:"top",content:t.description,container:t.target,trigger:"manual",template:'<div class="popover mg-popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'}).on("mouseenter",function(){E.selectAll(t.target).selectAll(".mg-popover").remove(),$(this).popover("show"),$(E.select(t.target).select(".popover").node()).on("mouseleave",function(){n.popover("hide")})}).on("mouseleave",function(){setTimeout(function(){$(".popover:hover").length||n.popover("hide")},120)})}else t.show_tooltips&&t.description&&"undefined"==typeof $&&(t.error="In order to enable tooltips, please make sure you include jQuery.")}t.error&&Ue(t)}function U(e,t,r,n,a){e.scalefns[t]=function(t){return void 0===a?e.scales[r](t[n]):e.scales[r](t[n])+a}}function B(t,e){return"bottom"===t||"top"===t?[Y(e),P(e)]:"left"===t||"right"===t?[v(e),e.top]:void 0}function I(t,e){return E.set(t.map(function(t){return t[e]})).values()}function H(e){var t;return null===e.color_domain?"number"===e.color_type?t=E.extent(e.data[0],function(t){return t[e.color_accessor]}):"category"===e.color_type&&(t=I(e.data[0],e.color_accessor)):t=e.color_domain,t}function q(t){return null===t.color_range?"number"===t.color_type?["blue","red"]:null:t.color_range}function V(t,e,r){var n=vt(t),a=n.secondary(t.processed.min_x,t.processed.max_x);0===a.length&&(a=[t.scales.X.ticks(t.xax_count)[0]]);var o,i,s,c=S(r,"mg-year-marker");"default"===n.timeframe&&t.show_year_markers&&(o=t,i=c,s=a,n.yformat,i.selectAll(".mg-year-marker").data(s).enter().append("line").attr("x1",function(t){return o.scales.X(t).toFixed(2)}).attr("x2",function(t){return o.scales.X(t).toFixed(2)}).attr("y1",M(o)).attr("y2",w(o))),"years"!=n.tick_diff_timeframe&&function(t,e,r,n,a){var o,i,s,c,l,u=e.position,f=e.namespace,d=t.scales[f.toUpperCase()],p=E.select(t.target).select(".mg-x-axis text").node().getBoundingClientRect();"top"===u&&(o=function(t,e){return d(t).toFixed(2)},i=M(t)-7*t.xax_tick_length/3-p.height,s=".50em",c="middle",l=function(t){return a(new Date(t))});"bottom"===u&&(o=function(t,e){return d(t).toFixed(2)},i=w(t)+7*t.xax_tick_length/3+.8*p.height,s=".50em",c="middle",l=function(t){return a(new Date(t))});r.selectAll(".mg-year-marker").data(n).enter().append("text").attr("x",o).attr("y",i).attr("dy",s).attr("text-anchor",c).text(l)}(t,e,c,a,n.yformat)}function W(t,n,e){var r,a,o,i,s,c,l,u=e.namespace,f=(r=n,o=(a=e).position,i=a.namespace,s=r[i+"ax_tick_length"],c=r.scales[i.toUpperCase()],l={},"left"===o&&(l.x=G(r)-3*s/2,l.y=function(t){return c(t).toFixed(2)},l.dx=-3,l.dy=".35em",l.textAnchor="end",l.text=function(t){return et(r)(t)}),"right"===o&&(l.x=A(r)+3*s/2,l.y=function(t){return c(t).toFixed(2)},l.dx=3,l.dy=".35em",l.textAnchor="start",l.text=function(t){return et(r)(t)}),"top"===o&&(l.x=function(t){return c(t).toFixed(2)},l.y=(M(r)-7*s/3).toFixed(2),l.dx=0,l.dy="0em",l.textAnchor="middle",l.text=function(t){return yt(r)(t)}),"bottom"===o&&(l.x=function(t){return c(t).toFixed(2)},l.y=(w(r)+7*s/3).toFixed(2),l.dx=0,l.dy=".50em",l.textAnchor="middle",l.text=function(t){return yt(r)(t)}),l),d=n.processed[u+"_ticks"],p=t.selectAll(".mg-yax-labels").data(d).enter().append("text").attr("x",f.x).attr("dx",f.dx).attr("y",f.y).attr("dy",f.dy).attr("text-anchor",f.textAnchor).text(f.text);("x"==u&&(n.time_series&&n.european_clock?(p.append("tspan").classed("mg-european-hours",!0).text(function(t,e){var r=new Date(t);return 0===e?E.timeFormat("%H")(r):""}),p.append("tspan").classed("mg-european-minutes-seconds",!0).text(function(t,e){var r=new Date(t);return":"+n.processed.xax_format(r)})):p.text(function(t){return n.xax_units+n.processed.xax_format(t)}),n.time_series&&(n.show_years||n.show_secondary_x_label)&&V(n,e,t)),g(p))&&(p.filter(function(t,e){return(e+1)%2==0}).remove(),O(n.target).selectAll(".mg-"+u+"ax-ticks").filter(function(t,e){return(e+1)%2==0}).remove())}function Q(t,e,r){var n,a,o,i,s,c,l,u,f=r.namespace,d=e.processed[f+"_ticks"].length,p=(n=e,o=(a=r).namespace,i=a.position,s=n.processed[o+"_ticks"].length,c=n.processed[o+"_ticks"],l=n.scales[o.toUpperCase()],u={},"left"===i&&(u.x1=G(n),u.x2=G(n),u.y1=l(c[0]).toFixed(2),u.y2=l(c[s-1]).toFixed(2)),"right"===i&&(u.x1=A(n),u.x2=A(n),u.y1=l(c[0]).toFixed(2),u.y2=l(c[s-1]).toFixed(2)),"top"===i&&(u.x1=G(n),u.x2=A(n),u.y1=M(n),u.y2=M(n)),"bottom"===i&&(u.x1=G(n),u.x2=A(n),u.y1=w(n),u.y2=w(n)),"left"!==i&&"right"!==i||(n.axes_not_compact?(u.y1=w(n),u.y2=M(n)):s&&(u.y1=l(c[0]).toFixed(2),u.y2=l(c[s-1]).toFixed(2))),u);e[f+"_extended_ticks"]||e[f+"_extended_ticks"]||!d||t.append("line").attr("x1",p.x1).attr("x2",p.x2).attr("y1",p.y1).attr("y2",p.y2)}function Z(t,e){t.rug_buffer_size="point"===t.chart_type?t.buffer/2:2*t.buffer/3;var r,n,a,o,i,s,c,l,u,f,d=(r=t,n="mg-"+e.namespace+"-rug",a=O(r.target),o=h(r.data),(i=a.selectAll("line."+n).data(o)).enter().append("svg:line").attr("class",n).attr("opacity",.3),_(i),_(i),i),p=(s=t,l=(c=e).position,u=c.namespace,f={},"left"===l&&(f.x1=G(s)+1,f.x2=G(s)+s.rug_buffer_size,f.y1=s.scalefns[u+"f"],f.y2=s.scalefns[u+"f"]),"right"===l&&(f.x1=A(s)-1,f.x2=A(s)-s.rug_buffer_size,f.y1=s.scalefns[u+"f"],f.y2=s.scalefns[u+"f"]),"top"===l&&(f.x1=s.scalefns[u+"f"],f.x2=s.scalefns[u+"f"],f.y1=M(s)+1,f.y2=M(s)+s.rug_buffer_size),"bottom"===l&&(f.x1=s.scalefns[u+"f"],f.x2=s.scalefns[u+"f"],f.y1=w(s)-1,f.y2=w(s)-s.rug_buffer_size),f);d.attr("x1",p.x1).attr("x2",p.x2).attr("y1",p.y1).attr("y2",p.y2),m(d,t,"mg-"+e.namespace+"-rug-mono")}function K(p,_){var m=_.namespace,t="mg-"+m+"-axis",g=p.scales[m.toUpperCase()],e=p.scales[(m+"group").toUpperCase()],h=m+"group_accessor",r=O(p.target);D(r,"."+t);var x,y=S(r,t);(e.domain&&e.domain()?e.domain():["1"]).forEach(function(t){var e,r,n,a,o,i,s,c,l,u,f,d=(e=p,n=t,a=(r=_).namespace,o=r.position,i=e.scales[a.toUpperCase()],s=e.scales[(a+"group").toUpperCase()],c={cat:{},group:{}},"left"===o&&(c.cat.x=Y(e)-e.buffer,c.cat.y=function(t){return s(n)+i(t)+i.bandwidth()/2},c.cat.dy=".35em",c.cat.textAnchor="end",c.group.x=Y(e)-e.buffer,c.group.y=s(n)+(s.bandwidth?s.bandwidth()/2:0),c.group.dy=".35em",c.group.textAnchor=(e["rotate_"+a+"_labels"],"end")),"right"===o&&(c.cat.x=P(e)-e.buffer,c.cat.y=function(t){return s(n)+i(t)+i.bandwidth()/2},c.cat.dy=".35em",c.cat.textAnchor="start",c.group.x=P(e)-e.buffer,c.group.y=s(n)+(s.bandwidth?s.bandwidth()/2:0),c.group.dy=".35em",c.group.textAnchor="start"),"top"===o&&(c.cat.x=function(t){return s(n)+i(t)+i.bandwidth()/2},c.cat.y=b(e)+e.buffer,c.cat.dy=".35em",c.cat.textAnchor=e["rotate_"+a+"_labels"]?"start":"middle",c.group.x=s(n)+(s.bandwidth?s.bandwidth()/2:0),c.group.y=b(e)+e.buffer,c.group.dy=".35em",c.group.textAnchor=e["rotate_"+a+"_labels"]?"start":"middle"),"bottom"===o&&(c.cat.x=function(t){return s(n)+i(t)+i.bandwidth()/2},c.cat.y=v(e)+e.buffer,c.cat.dy=".35em",c.cat.textAnchor=e["rotate_"+a+"_labels"]?"start":"middle",c.group.x=s(n)+(s.bandwidth?s.bandwidth()/2-i.bandwidth()/2:0),c.group.y=v(e)+e.buffer,c.group.dy=".35em",c.group.textAnchor=e["rotate_"+a+"_labels"]?"start":"middle"),c);x=S(y,"mg-group-"+F(t)),l=null!==p[h]?x.append("text").classed("mg-barplot-group-label",!0).attr("x",d.group.x).attr("y",d.group.y).attr("dy",d.group.dy).attr("text-anchor",d.group.textAnchor).text(t):x.selectAll("text").data(g.domain()).enter().append("text").attr("x",d.cat.x).attr("y",d.cat.y).attr("dy",d.cat.dy).attr("text-anchor",d.cat.textAnchor).text(String),p["rotate_"+m+"_labels"]&&(u=l,(f=p["rotate_"+m+"_labels"])&&u.attr("transform",function(){var t=E.select(this);return"rotate("+f+" "+t.attr("x")+","+t.attr("y")+")"}))})}MG.merge_with_defaults=p,MG.clone=function(t){var e,r;if(null===t||"object"!==(void 0===t?"undefined":c(t)))return t;if(C(t))return(e=new Date).setTime(t.getTime()),e;if(T(t)){e=[];for(var n=0,a=t.length;n<a;n++)e[n]=MG.clone(t[n]);return e}if(r=t,"[object Object]"!==Object.prototype.toString.call(r))throw new Error("Unable to copy obj! Its type isn't supported.");for(var o in e={},t)t.hasOwnProperty(o)&&(e[o]=MG.clone(t[o]));return e},MG.arr_diff=j,MG.warn_deprecation=L,MG.truncate_text=X,MG.wrap_text=function(t,i,s,c){t.each(function(){for(var t,e=E.select(this),r=e.text().split(s||/\s+/).reverse(),n=[],a=0,o=(e.attr("y"),e.text(null).append("tspan").attr("x",0).attr("y","0em").attr(c||{}));t=r.pop();)n.push(t),o.text(n.join(" ")),(null===i||o.node().getComputedTextLength()>i)&&(n.pop(),o.text(n.join(" ")),n=[t],o=e.append("tspan").attr("x",0).attr("y",1.1*++a+0+"em").attr(c||{}).text(t))})},MG.register=function(t,e,r){var n=r?x(r):{};MG.charts[t]={descriptor:e,defaults:n},r&&Object.keys(r).map(function(t){t in MG.options||(MG.options[t]=r[t])})},MG._hooks={},MG.add_hook=function(t,e,r){var n;if(MG._hooks[t]||(MG._hooks[t]=[]),0<(n=MG._hooks[t]).filter(function(t){return t.func===e}).length)throw"That function is already registered.";n.push({func:e,context:r})},MG.call_hook=function(t){var r,e=MG._hooks[t],n=[].slice.apply(arguments,[1]);return e&&e.forEach(function(t){if(t.func){var e=r||n;e&&e.constructor!==Array&&(e=[e]),e=[].concat.apply([],e),r=t.func.apply(t.context,e)}}),r||n},MG.globals={},MG.deprecations={rollover_callback:{replacement:"mouseover",version:"2.0"},rollout_callback:{replacement:"mouseout",version:"2.0"},x_rollover_format:{replacement:"x_mouseover",version:"2.10"},y_rollover_format:{replacement:"y_mouseover",version:"2.10"},show_years:{replacement:"show_secondary_x_label",version:"2.1"},xax_start_at_min:{replacement:"axes_not_compact",version:"2.7"},interpolate_tension:{replacement:"interpolate",version:"2.10"}},MG.globals.link=!1,MG.globals.version="1.1",MG.options={x_axis_type:[null,["categorical"]],y_axis_type:[null,["categorical"]],y_padding_percentage:[.05,"number"],y_outer_padding_percentage:[.1,"number"],ygroup_padding_percentage:[.25,"number"],ygroup_outer_padding_percentage:[0,"number"],x_padding_percentage:[.05,"number"],x_outer_padding_percentage:[.1,"number"],xgroup_padding_percentage:[.25,"number"],xgroup_outer_padding_percentage:[0,"number"],ygroup_accessor:[null,"string"],xgroup_accessor:[null,"string"],y_categorical_show_guides:[!1,"boolean"],x_categorical_show_guide:[!1,"boolean"],rotate_x_labels:[0,"number"],rotate_y_labels:[0,"number"],scales:[{}],scalefns:[{}],data:[[],["object[]","number[]"]],missing_is_zero:[!1,"boolean"],missing_is_hidden:[!1,"boolean"],missing_is_hidden_accessor:[null,"string"],utc_time:[!1,"boolean"],x_accessor:["date","string"],x_sort:[!0,"boolean"],y_accessor:["value",["string","string[]"]],axes_not_compact:[!0,"boolean"],european_clock:[!1,"boolean"],inflator:[10/9,"number"],max_x:[null,["number",Date]],max_y:[null,["number",Date]],min_x:[null,["number",Date]],min_y:[null,["number",Date]],min_y_from_data:[!1,"boolean"],show_year_markers:[!1,"boolean"],show_secondary_x_label:[!0,"boolean"],small_text:[!1,"boolean"],x_extended_ticks:[!1,"boolean"],x_axis:[!0,"boolean"],x_label:["","string"],xax_count:[6,"number"],xax_format:[null,"function"],xax_tick_length:[5,"number"],xax_units:["","string"],x_scale_type:["linear","log"],y_axis:[!0,"boolean"],x_axis_position:["bottom"],y_axis_position:["left"],y_extended_ticks:[!1,"boolean"],y_label:["","string"],y_scale_type:["linear",["linear","log"]],yax_count:[3,"number"],yax_format:[null,"function"],yax_tick_length:[5,"number"],yax_units:["","string"],yax_units_append:[!1,"boolean"],aggregate_rollover:[!1,"boolean"],animate_on_load:[!1,"boolean"],area:[!0,["boolean","array"]],flip_area_under_y_value:[null,"number"],baselines:[null,"object[]"],chart_type:["line",["line","histogram","point","bar","missing-data"]],color:[null,["string","string[]"]],colors:[null,["string","string[]"]],custom_line_color_map:[[],"number[]"],decimals:[2,"number"],error:["","string"],format:["count",["count","percentage"]],full_height:[!1,"boolean"],full_width:[!1,"boolean"],interpolate:[E.curveCatmullRom.alpha(0),[E.curveBasisClosed,E.curveBasisOpen,E.curveBasis,E.curveBundle,E.curveCardinalClosed,E.curveCardinalOpen,E.curveCardinal,E.curveCatmullRomClosed,E.curveCatmullRomOpen,E.curveLinearClosed,E.curveLinear,E.curveMonotoneX,E.curveMonotoneY,E.curveNatural,E.curveStep,E.curveStepAfter,E.curveStepBefore]],legend:["","string[]"],legend_target:["","string"],linked:[!1,"boolean"],linked_format:["%Y-%m-%d","string"],list:[!1,"boolean"],markers:[null,"object[]"],max_data_size:[null,"number"],missing_text:[null,"string"],show_missing_background:[!0,"boolean"],mousemove_align:["right","string"],x_mouseover:[null,["string","function"]],y_mouseover:[null,["string","function"]],mouseover:[null,"function"],mousemove:[null,"function"],mouseout:[null,"function"],click:[null,"function"],point_size:[2.5,"number"],active_point_on_lines:[!1,"boolean"],active_point_accessor:["active","string"],active_point_size:[2,"number"],points_always_visible:[!1,"boolean"],rollover_time_format:[null,"string"],show_confidence_band:[null,"string[]"],show_rollover_text:[!0,"boolean"],show_tooltips:[!0,"boolean"],showActivePoint:[!0,"boolean"],target:["#viz",["string",HTMLElement]],transition_on_update:[!0,"boolean"],x_rug:[!1,"boolean"],y_rug:[!1,"boolean"],mouseover_align:["right",["right","left"]],brush:[null,["xy","x","y"]],brushing_selection_changed:[null,"function"],zoom_target:[null,"object"],click_to_zoom_out:[!0,"boolean"],buffer:[8,"number"],bottom:[45,"number"],center_title_full_width:[!1,"boolean"],height:[220,"number"],left:[50,"number"],right:[10,"number"],small_height_threshold:[120,"number"],small_width_threshold:[160,"number"],top:[65,"number"],width:[350,"number"],title_y_position:[10,"number"],title:[null,"string"],description:[null,"string"]},MG.charts={},MG.defaults=x(MG.options),MG.data_graphic=function(t){for(var e in MG.call_hook("global.defaults",MG.defaults),t||(t={}),t)y(e,t[e])||(e in MG.options?console.warn("Option "+e+" expected type "+MG.options[e][1]+" but got "+t[e]+" instead"):console.warn("Option "+e+" not recognized"));var r=MG.charts[t.chart_type||MG.defaults.chart_type];for(var n in p(t,r.defaults,MG.defaults),t.list&&(t.x_accessor=0,t.y_accessor=1),MG.deprecations)if(t.hasOwnProperty(n)){var a=MG.deprecations[n],o="Use of `args."+n+"` has been deprecated",i=a.replacement;if(i&&(t[i]?o+=". The replacement - `args."+i+"` - has already been defined. This definition will be discarded.":t[i]=t[n]),a.warned)continue;a.warned=!0,i&&(o+=" in favor of `args."+i+"`"),L(o,a.version)}return MG.call_hook("global.before_init",t),new r.descriptor(t),t.data},k()&&(function(m){var g=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};g.VERSION="3.3.5",g.TRANSITION_DURATION=150,g.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},g.prototype.init=function(t,e,r){if(this.enabled=!0,this.type=t,this.$element=m(e),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&m(m.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),a=n.length;a--;){var o=n[a];if("click"==o)this.$element.on("click."+this.type,this.options.selector,m.proxy(this.toggle,this));else if("manual"!=o){var i="hover"==o?"mouseenter":"focusin",s="hover"==o?"mouseleave":"focusout";this.$element.on(i+"."+this.type,this.options.selector,m.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,m.proxy(this.leave,this))}}this.options.selector?this._options=m.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},g.prototype.getDefaults=function(){return g.DEFAULTS},g.prototype.getOptions=function(t){return(t=m.extend({},this.getDefaults(),this.$element.data(),t)).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},g.prototype.getDelegateOptions=function(){var r={},n=this.getDefaults();return this._options&&m.each(this._options,function(t,e){n[t]!=e&&(r[t]=e)}),r},g.prototype.enter=function(t){var e=t instanceof this.constructor?t:m(t.currentTarget).data("bs."+this.type);if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),m(t.currentTarget).data("bs."+this.type,e)),t instanceof m.Event&&(e.inState["focusin"==t.type?"focus":"hover"]=!0),e.tip().hasClass("in")||"in"==e.hoverState)e.hoverState="in";else{if(clearTimeout(e.timeout),e.hoverState="in",!e.options.delay||!e.options.delay.show)return e.show();e.timeout=setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show)}},g.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},g.prototype.leave=function(t){var e=t instanceof this.constructor?t:m(t.currentTarget).data("bs."+this.type);if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),m(t.currentTarget).data("bs."+this.type,e)),t instanceof m.Event&&(e.inState["focusout"==t.type?"focus":"hover"]=!1),!e.isInStateTrue()){if(clearTimeout(e.timeout),e.hoverState="out",!e.options.delay||!e.options.delay.hide)return e.hide();e.timeout=setTimeout(function(){"out"==e.hoverState&&e.hide()},e.options.delay.hide)}},g.prototype.show=function(){var t=m.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var e=m.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!e)return;var r=this,n=this.tip(),a=this.getUID(this.type);this.setContent(),n.attr("id",a),this.$element.attr("aria-describedby",a),this.options.animation&&n.addClass("fade");var o="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,s=i.test(o);s&&(o=o.replace(i,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(o).data("bs."+this.type,this),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),l=n[0].offsetWidth,u=n[0].offsetHeight;if(s){var f=o,d=this.getPosition(this.$viewport);o="bottom"==o&&c.bottom+u>d.bottom?"top":"top"==o&&c.top-u<d.top?"bottom":"right"==o&&c.right+l>d.width?"left":"left"==o&&c.left-l<d.left?"right":o,n.removeClass(f).addClass(o)}var p=this.getCalculatedOffset(o,c,l,u);this.applyPlacement(p,o);var _=function(){var t=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==t&&r.leave(r)};m.support.transition&&this.$tip.hasClass("fade")?n.one("bsTransitionEnd",_).emulateTransitionEnd(g.TRANSITION_DURATION):_()}},g.prototype.applyPlacement=function(t,e){var r=this.tip(),n=r[0].offsetWidth,a=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),i=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(i)&&(i=0),t.top+=o,t.left+=i,m.offset.setOffset(r[0],m.extend({using:function(t){r.css({top:Math.round(t.top),left:Math.round(t.left)})}},t),0),r.addClass("in");var s=r[0].offsetWidth,c=r[0].offsetHeight;"top"==e&&c!=a&&(t.top=t.top+a-c);var l=this.getViewportAdjustedDelta(e,t,s,c);l.left?t.left+=l.left:t.top+=l.top;var u=/top|bottom/.test(e),f=u?2*l.left-n+s:2*l.top-a+c,d=u?"offsetWidth":"offsetHeight";r.offset(t),this.replaceArrow(f,r[0][d],u)},g.prototype.replaceArrow=function(t,e,r){this.arrow().css(r?"left":"top",50*(1-t/e)+"%").css(r?"top":"left","")},g.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},g.prototype.hide=function(t){var e=this,r=m(this.$tip),n=m.Event("hide.bs."+this.type);function a(){"in"!=e.hoverState&&r.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),t&&t()}if(this.$element.trigger(n),!n.isDefaultPrevented())return r.removeClass("in"),m.support.transition&&r.hasClass("fade")?r.one("bsTransitionEnd",a).emulateTransitionEnd(g.TRANSITION_DURATION):a(),this.hoverState=null,this},g.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},g.prototype.hasContent=function(){return this.getTitle()},g.prototype.getPosition=function(t){var e=(t=t||this.$element)[0],r="BODY"==e.tagName,n=e.getBoundingClientRect();null==n.width&&(n=m.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var a=r?{top:0,left:0}:t.offset(),o={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},i=r?{width:m(window).width(),height:m(window).height()}:null;return m.extend({},n,o,i,a)},g.prototype.getCalculatedOffset=function(t,e,r,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-r/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-r/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-r}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},g.prototype.getViewportAdjustedDelta=function(t,e,r,n){var a={top:0,left:0};if(!this.$viewport)return a;var o=this.options.viewport&&this.options.viewport.padding||0,i=this.getPosition(this.$viewport);if(/right|left/.test(t)){var s=e.top-o-i.scroll,c=e.top+o-i.scroll+n;s<i.top?a.top=i.top-s:c>i.top+i.height&&(a.top=i.top+i.height-c)}else{var l=e.left-o,u=e.left+o+r;l<i.left?a.left=i.left-l:u>i.right&&(a.left=i.left+i.width-u)}return a},g.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},g.prototype.getUID=function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},g.prototype.tip=function(){if(!this.$tip&&(this.$tip=m(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},g.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},g.prototype.enable=function(){this.enabled=!0},g.prototype.disable=function(){this.enabled=!1},g.prototype.toggleEnabled=function(){this.enabled=!this.enabled},g.prototype.toggle=function(t){var e=this;t&&((e=m(t.currentTarget).data("bs."+this.type))||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),m(t.currentTarget).data("bs."+this.type,e))),t?(e.inState.click=!e.inState.click,e.isInStateTrue()?e.enter(e):e.leave(e)):e.tip().hasClass("in")?e.leave(e):e.enter(e)},g.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null})};var t=m.fn.tooltip;m.fn.tooltip=function(n){return this.each(function(){var t=m(this),e=t.data("bs.tooltip"),r="object"==(void 0===n?"undefined":c(n))&&n;!e&&/destroy|hide/.test(n)||(e||t.data("bs.tooltip",e=new g(this,r)),"string"==typeof n&&e[n]())})},m.fn.tooltip.Constructor=g,m.fn.tooltip.noConflict=function(){return m.fn.tooltip=t,this}}(jQuery),function(a){var o=function(t,e){this.init("popover",t,e)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");o.VERSION="3.3.5",o.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),((o.prototype=a.extend({},a.fn.tooltip.Constructor.prototype)).constructor=o).prototype.getDefaults=function(){return o.DEFAULTS},o.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),r=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof r?"html":"append":"text"](r),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},o.prototype.hasContent=function(){return this.getTitle()||this.getContent()},o.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},o.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var t=a.fn.popover;a.fn.popover=function(n){return this.each(function(){var t=a(this),e=t.data("bs.popover"),r="object"==(void 0===n?"undefined":c(n))&&n;!e&&/destroy|hide/.test(n)||(e||t.data("bs.popover",e=new o(this,r)),"string"==typeof n&&e[n]())})},a.fn.popover.Constructor=o,a.fn.popover.noConflict=function(){return a.fn.popover=t,this}}(jQuery)),MG.chart_title=N,MG.scale_factory=function(o){var i={use_inflator:!1,zero_bottom:!1,scaleType:"numerical"};return this.namespace=function(t){return i.namespace=t,i.namespace_accessor_name=i.namespace+"_accessor",i.scale_name=i.namespace.toUpperCase(),i.scalefn_name=i.namespace+"f",this},this.scaleName=function(t){return i.scale_name=t.toUpperCase(),i.scalefn_name=t+"f",this},this.inflateDomain=function(t){return i.use_inflator=t,this},this.zeroBottom=function(t){return i.zero_bottom=t,this},this.numericalDomainFromData=function(){var t,e=[];0<arguments.length&&(e=arguments);for(var r=0;r<o.data.length;r++)0<o.data[r].length&&(t=o.data[r]);i.is_time_series=!!C(t[0][o[i.namespace_accessor_name]]),U(o,i.scalefn_name,i.scale_name,o[i.namespace_accessor_name]),function(t,e,r){var n=e.namespace,a=e.namespace_accessor_name,o=e.use_inflator,i=e.zero_bottom,s=t[a],c=h(t.data).map(function(t){return t[s]}).concat(h(r));"log"===t[n+"_scale_type"]&&(c=c.filter(function(t){return 0<t}));var l=E.extent(c),u=l[0],f=l[1];i&&!t["min_"+n+"_from_data"]&&0<u&&!e.is_time_series&&(u="log"===t[n+"_scale_type"]?1:0),"log"!==t[n+"_scale_type"]&&u<0&&!e.is_time_series&&(u-=(u-u*t.inflator)*o),e.is_time_series||(f=f<0?f+(f-f*t.inflator)*o:f*(o?t.inflator:1)),u=null!=t["min_"+n]?t["min_"+n]:u,f=null!=t["max_"+n]?t["max_"+n]:f,u===f&&null==t["min_"+n]&&null==t["max_"+n]&&(C(u)?f=new Date(MG.clone(u).setDate(u.getDate()+1)):"number"==typeof u&&(f=u+1,t.xax_count=2)),t.processed["min_"+n]=u,t.processed["max_"+n]=f,t.processed["zoom_"+n]&&(t.processed["min_"+n]=t.processed["zoom_"+n][0],t.processed["max_"+n]=t.processed["zoom_"+n][1]),MG.call_hook("x_axis.process_min_max",t,t.processed.min_x,t.processed.max_x),MG.call_hook("y_axis.process_min_max",t,t.processed.min_y,t.processed.max_y)}(o,i,e,i.use_inflator);var n=o.utc_time?E.scaleUtc():E.scaleTime();return o.scales[i.scale_name]=i.is_time_series?n:R(o[i.namespace+"_scale_type"])?o.y_scale_type():"log"===o[i.namespace+"_scale_type"]?E.scaleLog():E.scaleLinear(),o.scales[i.scale_name].domain([o.processed["min_"+i.namespace],o.processed["max_"+i.namespace]]),i.scaleType="numerical",this},this.categoricalDomain=function(t){return o.scales[i.scale_name]=E.scaleOrdinal().domain(t),U(o,i.scalefn_name,i.scale_name,o[i.namespace_accessor_name]),this},this.categoricalDomainFromData=function(){var t=h(o.data);return i.categoricalVariables=E.set(t.map(function(t){return t[o[i.namespace_accessor_name]]})).values(),o.scales[i.scale_name]=E.scaleBand().domain(i.categoricalVariables),i.scaleType="categorical",this},this.numericalRange=function(t){return"string"==typeof t?o.scales[i.scale_name].range(B(t,o)):o.scales[i.scale_name].range(t),this},this.categoricalRangeBands=function(t,e){void 0===e&&(e=!1);var r=i.namespace,n=o[r+"_padding_percentage"],a=o[r+"_outer_padding_percentage"];return"string"==typeof t?o.scales[i.scale_name].range(B(t,o)).paddingInner(n).paddingOuter(a):o.scales[i.scale_name].range(t).paddingInner(n).paddingOuter(a),U(o,i.scalefn_name,i.scale_name,o[i.namespace_accessor_name],e?o.scales[i.scale_name].bandwidth()/2:0),this},this.categoricalRange=function(t){return o.scales[i.scale_name].range(t),U(o,i.scalefn_name,i.scale_name,o[i.namespace_accessor_name]),this},this.categoricalColorRange=function(){return o.scales[i.scale_name]=10<o.scales[i.scale_name].domain().length?E.scaleOrdinal(E.schemeCategory20):E.scaleOrdinal(E.schemeCategory10),o.scales[i.scale_name].domain(i.categoricalVariables),U(o,i.scalefn_name,i.scale_name,o[i.namespace_accessor_name]),this},this.clamp=function(t){return o.scales[i.scale_name].clamp(t),this},this};var J={};function tt(t){if(t.y_rug){t.rug_buffer_size="point"===t.chart_type?t.buffer/2:2*t.buffer/3;var e=r(t,"mg-y-rug");e.attr("x1",t.left+1).attr("x2",t.left+t.rug_buffer_size).attr("y1",t.scalefns.yf).attr("y2",t.scalefns.yf),m(e,t,"mg-y-rug-mono")}}function et(r){var t=r.yax_format;if(!t){var n=r.decimals;t="count"===r.format?(1<r.processed.y_ticks.length&&(n=Math.max(0,-Math.floor(Math.log(Math.abs(r.processed.y_ticks[1]-r.processed.y_ticks[0]))/Math.LN10))),function(t){var e;return e=0!==n?E.format(",."+n+"f"):t<1e3?E.format(",.0f"):E.format(",.2s"),r.yax_units_append?e(t)+r.yax_units:r.yax_units+e(t)}):function(t){return E.format(".0%")(t)}}return t}function rt(t){var e=O(t.target),r=t.scales.X.domain();if(r[0]<=0&&0<=r[1]){var n=t.scales.Y.range(),a=t.categorical_groups.length?t.scales.YGROUP(t.categorical_groups[t.categorical_groups.length-1]):t.scales.YGROUP();e.append("svg:line").attr("x1",t.scales.X(0)).attr("x2",t.scales.X(0)).attr("y1",n[0]+b(t)).attr("y2",n[n.length-1]+a).attr("stroke","black").attr("opacity",.2)}}function nt(t,e){e.y_label&&t.append("text").attr("class","label").attr("x",function(){return-1*(b(e)+(v(e)-b(e))/2)}).attr("y",function(){return e.left/2}).attr("dy","-1.2em").attr("text-anchor","middle").text(function(t){return e.y_label}).attr("transform",function(t){return"rotate(-90)"})}function at(t){t.processed||(t.processed={});var e=O(t.target);if(MG.call_hook("y_axis.process_min_max",t,t.processed.min_y,t.processed.max_y),D(e,".mg-y-axis"),!t.y_axis)return this;var r,n,a,o,i,s,c,l,u,f=S(e,"mg-y-axis");return nt(f,t),Ge(t,"y"),r=f,i=(n=t).processed.y_ticks.length,n.x_extended_ticks||n.y_extended_ticks||!i||(o=n.axes_not_compact&&"bar"!==n.chart_type?(a=n.height-n.bottom,n.top):i?(a=n.scales.Y(n.processed.y_ticks[0]).toFixed(2),n.scales.Y(n.processed.y_ticks[i-1]).toFixed(2)):a=0,r.append("line").attr("x1",n.left).attr("x2",n.left).attr("y1",a).attr("y2",o)),s=t,f.selectAll(".mg-yax-ticks").data(s.processed.y_ticks).enter().append("line").classed("mg-extended-yax-ticks",s.y_extended_ticks).attr("x1",s.left).attr("x2",function(){return s.y_extended_ticks?s.width-s.right:s.left-s.yax_tick_length}).attr("y1",function(t){return s.scales.Y(t).toFixed(2)}).attr("y2",function(t){return s.scales.Y(t).toFixed(2)}),c=f,u=et(l=t),c.selectAll(".mg-yax-labels").data(l.processed.y_ticks).enter().append("text").attr("x",l.left-3*l.yax_tick_length/2).attr("dx",-3).attr("y",function(t){return l.scales.Y(t).toFixed(2)}).attr("dy",".35em").attr("text-anchor","end").text(function(t){return u(t)}),t.y_rug&&tt(t),this}function ot(o){var t=O(o.target);D(t,".mg-y-axis");var i,s=S(t,"mg-y-axis");(o.categorical_groups.length?o.categorical_groups:["1"]).forEach(function(t){var e,r,n,a;(i=S(s,"mg-group-"+F(t)),null!==o.ygroup_accessor)?(n=t,a=o,i.append("svg:text").classed("mg-barplot-group-label",!0).attr("x",a.left-a.buffer).attr("y",a.scales.YGROUP(n)+a.scales.YGROUP.bandwidth()/2).attr("dy",".35em").attr("text-anchor","end").text(n)):l((e=t,r=o,i.selectAll("text").data(r.scales.Y.domain()).enter().append("svg:text").attr("x",r.left-r.buffer).attr("y",function(t){return r.scales.YGROUP(e)+r.scales.Y(t)+r.scales.Y.bandwidth()/2}).attr("dy",".35em").attr("text-anchor","end").text(String)),o.rotate_y_labels)})}function it(t){if(t.x_rug){t.rug_buffer_size="point"===t.chart_type?t.buffer/2:t.buffer;var e=r(t,"mg-x-rug");e.attr("x1",t.scalefns.xf).attr("x2",t.scalefns.xf).attr("y1",t.height-t.bottom-t.rug_buffer_size).attr("y2",t.height-t.bottom),m(e,t,"mg-x-rug-mono")}}function st(t){var e,r,n,a=O(t.target);if((e=t).processed||(e.processed={}),n=(r=t).chart_type,r.processed.xax_format||(r.xax_format?r.processed.xax_format=r.xax_format:"line"===n||"point"===n||"histogram"===n?r.processed.xax_format=yt(r):"bar"===n&&(r.processed.xax_format=ut(r))),D(a,".mg-x-axis"),!t.x_axis)return this;var o,i,s,c,l,u,f,d,p,_,m=S(a,"mg-x-axis");return o=m,Ge(i=t,"x"),l=o,u=(c=i).scales.X.ticks(c.xax_count).length-1,c.x_extended_ticks||l.append("line").attr("x1",function(){return 0===c.xax_count?Y(c):c.axes_not_compact&&"bar"!==c.chart_type?c.left:c.scales.X(c.scales.X.ticks(c.xax_count)[0]).toFixed(2)}).attr("x2",function(){return 0===c.xax_count||c.axes_not_compact&&"bar"!==c.chart_type?A(c):c.scales.X(c.scales.X.ticks(c.xax_count)[u]).toFixed(2)}).attr("y1",c.height-c.bottom).attr("y2",c.height-c.bottom),s=i,o.selectAll(".mg-xax-ticks").data(s.processed.x_ticks).enter().append("line").attr("x1",function(t){return s.scales.X(t).toFixed(2)}).attr("x2",function(t){return s.scales.X(t).toFixed(2)}).attr("y1",s.height-s.bottom).attr("y2",function(){return s.x_extended_ticks?s.top:s.height-s.bottom+s.xax_tick_length}).attr("class",function(){if(s.x_extended_ticks)return"mg-extended-xax-ticks"}).classed("mg-xax-ticks",!0),function(n,t){var e=t.selectAll(".mg-xax-labels").data(n.processed.x_ticks).enter().append("text").attr("x",function(t){return n.scales.X(t).toFixed(2)}).attr("y",(n.height-n.bottom+7*n.xax_tick_length/3).toFixed(2)).attr("dy",".50em").attr("text-anchor","middle");if(n.time_series&&n.european_clock?(e.append("tspan").classed("mg-european-hours",!0).text(function(t,e){var r=new Date(t);return 0===e?E.timeFormat("%H")(r):""}),e.append("tspan").classed("mg-european-minutes-seconds",!0).text(function(t,e){var r=new Date(t);return":"+n.processed.xax_format(r)})):e.text(function(t){return n.xax_units+n.processed.xax_format(t)}),g(e)){e.filter(function(t,e){return(e+1)%2==0}).remove();var r=O(n.target);r.selectAll(".mg-xax-ticks").filter(function(t,e){return(e+1)%2==0}).remove()}}(d=t,f=m),_=f,(p=d).time_series&&(p.show_years||p.show_secondary_x_label)&&function(t,e){var r=vt(t),n=r.secondary(t.processed.min_x,t.processed.max_x);if(0===n.length){var a=t.scales.X.ticks(t.xax_count)[0];n=[a]}var o,i,s,c,l,u,f,d=S(e,"mg-year-marker");"default"===r.timeframe&&t.show_year_markers&&(o=t,i=d,s=n,r.yformat,i.selectAll(".mg-year-marker").data(s).enter().append("line").attr("x1",function(t){return o.scales.X(t).toFixed(2)}).attr("x2",function(t){return o.scales.X(t).toFixed(2)}).attr("y1",M(o)).attr("y2",w(o))),"years"!=r.tick_diff_time_frame&&(c=t,l=d,u=n,f=r.yformat,l.selectAll(".mg-year-marker").data(u).enter().append("text").attr("x",function(t,e){return c.scales.X(t).toFixed(2)}).attr("y",function(){var t=E.select(c.target).select(".mg-x-axis text").node().getBoundingClientRect();return w(c)+7*c.xax_tick_length/3+.8*t.height}).attr("dy",".50em").attr("text-anchor","middle").text(function(t){return f(new Date(t))}))}(p,_),t.x_label&&lt(m,t),t.x_rug&&it(t),this}function H(e){var t;return null===e.color_domain?"number"===e.color_type?t=E.extent(e.data[0],function(t){return t[e.color_accessor]}):"category"===e.color_type&&(t=E.set(e.data[0].map(function(t){return t[e.color_accessor]})).values()).sort():t=e.color_domain,t}function q(t){return null===t.color_range?"number"===t.color_type?["blue","red"]:null:t.color_range}function ct(t){return null===t.size_range?[1,5]:t.size_range}function lt(t,e){e.x_label&&t.append("text").attr("class","label").attr("x",function(){return Y(e)+(P(e)-Y(e))/2}).attr("dx",null!=e.x_label_nudge_x?e.x_label_nudge_x:0).attr("y",function(){var t=E.select(e.target).select(".mg-x-axis text").node().getBoundingClientRect();return w(e)+e.xax_tick_length*(7/3)+.8*t.height+10}).attr("dy",".5em").attr("text-anchor","middle").text(function(t){return e.x_label})}function ut(r){return function(t){if(t<1&&-1<t&&0!==t)return r.xax_units+t.toFixed(r.decimals);var e=E.format(",.0f");return r.xax_units+e(t)}}function ft(t){return dt(t)?"millis":pt(t)?"seconds":_t(t)?"less-than-a-day":mt(t)?"four-days":gt(t)?"many-days":ht(t)?"many-months":365<=t/86400?"years":"default"}function dt(t){return t<1}function pt(t){return t<60}function _t(t){return t/3600<24}function mt(t){return t/3600<96}function gt(t){return t/86400<60}function ht(t){return t/86400<365}function xt(t){if(t.time_series){var e=(t.processed.max_x-t.processed.min_x)/1e3,r=(t.processed.x_ticks[1]-t.processed.x_ticks[0])/1e3;t.processed.x_time_frame=ft(e),t.processed.x_tick_diff_time_frame=ft(r),t.processed.main_x_time_format=(n=t.utc_time,dt(a=r)?MG.time_format(n,"%M:%S.%L"):pt(a)?MG.time_format(n,"%M:%S"):_t(a)?MG.time_format(n,"%H:%M"):mt(a)||gt(a)?MG.time_format(n,"%b %d"):ht(a)?MG.time_format(n,"%b"):MG.time_format(n,"%Y"))}var n,a}function yt(r){if(r.xax_format)return r.xax_format;var t=h(r.processed.original_data||r.data)[0],n=t[r.processed.original_x_accessor||r.x_accessor];return void 0===n&&(n=t),function(t){return xt(r),C(n)?r.processed.main_x_time_format(new Date(t)):"number"!=typeof n?r.xax_units+t:(e=t%1!=0?E.format(",."+r.decimals+"f"):t<1e3?E.format(",.0f"):E.format(",.2s"),r.xax_units+e(t));var e}}function vt(t){var e={timeframe:t.processed.x_time_frame,tick_diff_timeframe:t.processed.x_tick_diff_time_frame};switch(e.timeframe){case"millis":case"seconds":e.secondary=E.timeDays,t.european_clock?e.yformat=MG.time_format(t.utc_time,"%b %d"):e.yformat=MG.time_format(t.utc_time,"%I %p");break;case"less-than-a-day":case"four-days":e.secondary=E.timeDays,e.yformat=MG.time_format(t.utc_time,"%b %d");break;case"many-days":case"many-months":e.secondary=E.timeYears,e.yformat=MG.time_format(t.utc_time,"%Y");break;default:e.secondary=E.timeYears,e.yformat=MG.time_format(t.utc_time,"%Y")}return e}function bt(t){var e=parseInt(t.width);t.full_width&&(e=d(t.target)),"categorical"===t.x_axis_type&&null===e&&(e=zt(t,"x")),t.width=e}function wt(t){var e=parseInt(t.height);t.full_height&&(e=f(t.target,"height")),"categorical"===t.y_axis_type&&null===e&&(e=zt(t,"y")),t.height=e}function kt(t,e){(!t.selectAll(".mg-main-line").empty()&&"line"!==e.chart_type||!t.selectAll(".mg-points").empty()&&"point"!==e.chart_type||!t.selectAll(".mg-histogram").empty()&&"histogram"!==e.chart_type||!t.selectAll(".mg-barplot").empty()&&"bar"!==e.chart_type)&&t.remove()}function Mt(t,e){return O(e.target).empty()&&(t=E.select(e.target).append("svg").classed("linked",e.linked).attr("width",e.width).attr("height",e.height)),t}function Gt(t,e){e.width!==Number(t.attr("width"))&&t.attr("width",e.width),e.height!==Number(t.attr("height"))&&t.attr("height",e.height)}function At(t,e){t.attr("viewBox","0 0 "+e.width+" "+e.height),(e.full_width||e.full_height)&&t.attr("preserveAspectRatio","xMinYMin meet")}function Dt(t,e){t.empty()&&console.warn('The specified target element "'+e.target+'" could not be found in the page. The chart will not be rendered.')}function Ot(t,e){var r,n,a,o="x"===e?t.width:t.height;!function(t,e){var r=t[e+"group_accessor"];if(t.categorical_groups=[],r){var n=t.data[0];t.categorical_groups=E.set(n.map(function(t){return t[r]})).values()}}(t,e),function(t,e){var r=t[e+"group_accessor"];if(t.total_bars=t.data[0].length,r){var n=(a=t.data[0],o=r,a.map(function(t){return t[o]}).reduce(function(t,e){return t[e]=t[e]+1||1,t},{}));n=E.max(Object.keys(n).map(function(t){return n[t]})),t.bars_per_group=n}else t.bars_per_group=t.data[0].length;var a,o}(t,e),function(t,e,r){var n=e+"group_height";if(r){var a="y"===e?(t.height-t.top-t.bottom-2*t.buffer)/(t.categorical_groups.length||1):(t.width-t.left-t.right-2*t.buffer)/(t.categorical_groups.length||1);t[n]=a}else{var o=(1+t[e+"_padding_percentage"])*t.bar_thickness;t[n]=t.bars_per_group*o+2*t[e+"_outer_padding_percentage"]*o}}(t,e,o),o&&(a=(r=t)[(n=e)+"group_height"]/(r.bars_per_group+r[n+"_outer_padding_percentage"]),r.bar_thickness=a-a*r[n+"_padding_percentage"])}function zt(t,e){return t[e+"group_height"]*(t.categorical_groups.length||1)+("y"===e?t.top+t.bottom+2*t.buffer:t.left+t.right+2*t.buffer)+t.categorical_groups.length*t[e+"group_height"]*(t[e+"group_padding_percentage"]+t[e+"group_outer_padding_percentage"])}function Ft(t){var e;t=arguments[0],(e=t)||(e={}),e.processed||(e.processed={}),t=e=p(e,{target:null,title:null,description:null});var r=E.select(t.target);Dt(r,t);var n,a,o,i,s,c,l,u=r.selectAll("svg");return"categorical"===t.y_axis_type&&Ot(t,"y"),"categorical"===t.x_axis_type&&Ot(t,"x"),a=(n=t).chart_type,n.processed.xax_format||(n.xax_format?n.processed.xax_format=n.xax_format:"line"===a||"point"===a||"histogram"===a?n.processed.xax_format=yt(n):"bar"===a&&(n.processed.xax_format=ut(n))),i=h((o=t).processed.original_data||o.data)[0],o.time_series=C(i[o.processed.original_x_accessor||o.x_accessor]),bt(t),wt(t),kt(u,t),u=Mt(u,t),c=t,(s=u).selectAll(".mg-clip-path").remove(),s.append("defs").attr("class","mg-clip-path").append("clipPath").attr("id","mg-plot-window-"+z(c.target)).append("svg:rect").attr("x",G(c)).attr("y",M(c)).attr("width",c.width-c.left-c.right-c.buffer).attr("height",c.height-c.top-c.bottom-c.buffer+1),Gt(u,t),At(u,t),(l=u).classed("mg-missing",!1),l.selectAll(".mg-missing-text").remove(),l.selectAll(".mg-missing-pane").remove(),N(t),function(t,e){var r=0;if(t.selectAll(".mg-main-line").nodes().length>=e.data.length)if(0<e.custom_line_color_map.length){var n=j(function(t){for(var e=new Array(t),r=0;r<e.length;r++)e[r]=r+1;return e}(e.max_data_size),e.custom_line_color_map);for(r=0;r<n.length;r++)t.selectAll(".mg-main-line.mg-line"+n[r]+"-color").remove()}else{var a=e.data.length;for(r=t.selectAll(".mg-main-line").nodes()?t.selectAll(".mg-main-line").nodes().length:0;a<r;r--)t.selectAll(".mg-main-line.mg-line"+r+"-color").remove()}}(u,t),this}function Ct(t){return t.label}function Tt(e){return function(t){return e.scales.X(t[e.x_accessor])>=Y(e)&&e.scales.X(t[e.x_accessor])<=P(e)}}function Rt(e){return function(t){return e.scales.X(t[e.x_accessor])}}function Et(t){var e=t.scales.Y;return function(t){return e(t.value).toFixed(2)}}function Yt(t,e,r,n,a,o){var i;t&&(a(i=n.append("g").attr("class",e),r),o(i,r))}function $t(t,e){var r,n=(r=Rt(e),function(t){return r(t).toFixed(2)});t.selectAll(".mg-markers").data(e.markers.filter(Tt(e))).enter().append("line").attr("x1",n).attr("x2",n).attr("y1",e.top).attr("y2",v(e)).attr("class",function(t){return t.lineclass}).attr("stroke-dasharray","3,1")}function Pt(t,e){t.selectAll(".mg-markers").data(e.markers.filter(Tt(e))).enter().append("text").attr("class",function(t){return t.textclass||""}).classed("mg-marker-text",!0).attr("x",Rt(e)).attr("y","bottom"===e.x_axis_position?.95*M(e):w(e)+e.buffer).attr("text-anchor","middle").text(Ct).each(function(t){t.click&&E.select(this).style("cursor","pointer").on("click",t.click),t.mouseover&&E.select(this).style("cursor","pointer").on("mouseover",t.mouseover),t.mouseout&&E.select(this).style("cursor","pointer").on("mouseout",t.mouseout)}),function(t,e){if(t&&1!=t.length)for(var r=0;r<t.length;r++)if(o(t[r],t)){var n=E.select(t[r]),a=+n.attr("y");a+8>=e.top&&(a=e.top-16),n.attr("y",a)}}(t.selectAll(".mg-marker-text").nodes(),e)}function St(t,e){var r=Et(e);t.selectAll(".mg-baselines").data(e.baselines).enter().append("line").attr("x1",Y(e)).attr("x2",P(e)).attr("y1",r).attr("y2",r)}function jt(t,e){var r=Et(e);t.selectAll(".mg-baselines").data(e.baselines).enter().append("text").attr("x",P(e)).attr("y",r).attr("dy",-3).attr("text-anchor","end").text(Ct)}function Lt(t){var e,r,n,a,o,i=O(t.target);return(e=i).selectAll(".mg-markers").remove(),e.selectAll(".mg-baselines").remove(),n=i,Yt((r=t).markers,"mg-markers",r,n,$t,Pt),o=i,Yt((a=t).baselines,"mg-baselines",a,o,St,jt),this}function Xt(t){t.selectAll(".mg-active-datapoint-container").selectAll("*").remove()}function Nt(t,e){t.select(".mg-active-datapoint").remove();var r,n="right"===e.mouseover_align?"end":"left"===e.mouseover_align?"start":"middle",a="right"===e.mouseover_align?P(e):"left"===e.mouseover_align?Y(e):(e.width-e.left-e.right)/2+e.left,o=t.select(".mg-active-datapoint-container").attr("transform","translate(0 -18)").append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("text-anchor",n),i=.75,s="bottom"===e.x_axis_position?M(e)*i:w(e)+3*e.buffer;e.markers&&t.selectAll(".mg-marker-text").each(function(){r?r!==E.select(this).attr("y")&&(i=.56):r=E.select(this).attr("y")});o.attr("transform","translate("+a+","+s+")")}function Ut(t,e){Nt(e.svg,t);var r,n,o={row_number:0,rargs:e,mouseover_row:function(t){return o.row_number+=1,e=o.row_number,r=o.text_container,n=t,a=r.append("tspan").attr("x",0).attr("y",1.1*e+"em"),{rargs:n,text:function(t){return e=t,{bold:function(){return r.attr("font-weight","bold")},font_size:function(t){return r.attr("font-size",t)},x:function(t){return r.attr("x",t)},y:function(t){return r.attr("y",t)},elem:r=a.append("tspan").text(e)};var e,r}};var e,r,n,a},text_container:(r=e.svg,n=r.select(".mg-active-datapoint"),n.selectAll("*").remove(),n)};return o}J.categorical=function(t,e){e.namespace;K(t,e),function(f,t){var d,p,_,m,e=t.namespace,g=(f.scalefns[e+"f"],f.scalefns[e+"groupf"],f.scales[(e+"group").toUpperCase()]),h=f.scales[e.toUpperCase()],x=t.position,r=O(f.target),n=g.domain&&g.domain()?g.domain():[null];D(r,".mg-category-guides");var y=S(r,"mg-category-guides");n.forEach(function(e){h.domain().forEach(function(t){"left"!==x&&"right"!==x||(d=Y(f),p=P(f),_=h(t)+g(e)+h.bandwidth()/2,m=h(t)+g(e)+h.bandwidth()/2),"top"!==x&&"bottom"!==x||(d=h(t)+g(e)+h.bandwidth()/2*(null===e),p=h(t)+g(e)+h.bandwidth()/2*(null===e),_=v(f),m=b(f)),y.append("line").attr("x1",d).attr("x2",p).attr("y1",_).attr("y2",m).attr("stroke-dasharray","2,1")});var t,r,n,a,o,i,s,c,l=g(e)+h(h.domain()[0])+h.bandwidth()/2*(null===e||"top"!==x&&"bottom"!=x),u=g(e)+h(h.domain()[h.domain().length-1])+h.bandwidth()/2*(null===e||"top"!==x&&"bottom"!=x);"left"!==x&&"right"!==x||(t=Y(f),r=Y(f),n=l,a=u,o=P(f),i=P(f),s=l,c=u),"bottom"!==x&&"top"!==x||(t=l,r=u,n=v(f),a=v(f),o=l,i=u,s=b(f),c=b(f)),y.append("line").attr("x1",t).attr("x2",r).attr("y1",n).attr("y2",a).attr("stroke-dasharray","2,1"),y.append("line").attr("x1",o).attr("x2",i).attr("y1",s).attr("y2",c).attr("stroke-dasharray","2,1")})}(t,e)},J.numerical=function(t,e){var r=e.namespace,n=r+"_axis",a="mg-"+r+"-axis",o=O(t.target);if(D(o,"."+a),!t[n])return this;var i,s,c,l,u,f,d,p,_,m,g,h,x,y,v,b=S(o,a);return function(t,e){var r=t[e+"_accessor"],n=t.scales[e.toUpperCase()].ticks(t[e+"ax_count"]),a=t.processed["max_"+e];function o(t){return 1e3===t?3:1e6===t?7:Math.log(t)/Math.LN10}"log"===t[e+"_scale_type"]&&(n=n.filter(function(t){return Math.abs(o(t))%1<1e-6||Math.abs(o(t))%1>1-1e-6}));var i=n.length,s=!0;t.data.forEach(function(t,e){t.forEach(function(t,e){if(t[r]%1!=0)return s=!1})}),s&&a<i&&"count"===t.format&&(n=n.filter(function(t){return t%1==0})),t.processed[e+"_ticks"]=n}(t,r),Q(b,t,e),i=b,s=t,p=(c=e).namespace,_=c.position,m=s.scales[p.toUpperCase()],g=s.processed[p+"_ticks"],h="mg-"+p+"ax-ticks",x="mg-extended-"+p+"ax-ticks",y=s[p+"_extended_ticks"],v=s[p+"ax_tick_length"],"left"===_&&(l=G(s),u=y?A(s):G(s)-v,f=function(t){return m(t).toFixed(2)},d=function(t){return m(t).toFixed(2)}),"right"===_&&(l=A(s),u=y?G(s):A(s)+v,f=function(t){return m(t).toFixed(2)},d=function(t){return m(t).toFixed(2)}),"top"===_&&(l=function(t){return m(t).toFixed(2)},u=function(t){return m(t).toFixed(2)},f=M(s),d=y?w(s):M(s)-v),"bottom"===_&&(l=function(t){return m(t).toFixed(2)},u=function(t){return m(t).toFixed(2)},f=w(s),d=y?M(s):w(s)+v),i.selectAll("."+h).data(g).enter().append("line").classed(x,y).attr("x1",l).attr("x2",u).attr("y1",f).attr("y2",d),W(b,t,e),t[r+"_label"]&&e.label(o.select(".mg-"+r+"-axis"),t),t[r+"_rug"]&&Z(t,e),t.show_bar_zero&&rt(t),this},MG.axis_factory=function(t){var e={type:"numerical"};return this.namespace=function(t){return e.namespace=t,this},this.rug=function(t){return e.rug=t,this},this.label=function(t){return e.label=t,this},this.type=function(t){return e.type=t,this},this.position=function(t){return e.position=t,this},this.zeroLine=function(t){return e.zeroLine=t,this},this.draw=function(){return J[e.type](t,e),this},this},MG.y_rug=tt,MG.y_axis=at,MG.y_axis_categorical=function(t){return t.y_axis&&(ot(t),t.show_bar_zero&&rt(t),t.ygroup_accessor&&(r=O((e=t).target),(n=e.scales.YGROUP.domain())[0],n[n.length-1],r.select(".mg-category-guides").selectAll("mg-group-lines").data(n).enter().append("line").attr("x1",Y(e)).attr("x2",Y(e)).attr("y1",function(t){return e.scales.YGROUP(t)}).attr("y2",function(t){return e.scales.YGROUP(t)+e.ygroup_height}).attr("stroke-width",1)),t.y_categorical_show_guides&&(o=O((a=t).target),i=[],a.data[0].forEach(function(t){-1===i.indexOf(t[a.y_accessor])&&o.select(".mg-category-guides").append("line").attr("x1",Y(a)).attr("x2",P(a)).attr("y1",a.scalefns.yf(t)+a.scalefns.ygroupf(t)).attr("y2",a.scalefns.yf(t)+a.scalefns.ygroupf(t)).attr("stroke-dasharray","2,1")}))),this;var e,r,n,a,o,i},MG.x_rug=it,MG.x_axis=st,MG.x_axis_categorical=function(t){var e=O(t.target),r=0;"bar"===t.chart_type&&(r=t.buffer+5),mg_add_categorical_scale(t,"X",t.categorical_variables.reverse(),t.left,P(t)-r),U(t,"xf","X","value"),D(e,".mg-x-axis");var n=S(e,"mg-x-axis");return t.x_axis&&(a=n,o=t,i=r,s=a.selectAll("text").data(o.categorical_variables).enter().append("text"),s.attr("x",function(t){return o.scales.X(t)+o.scales.X.bandwidth()/2+o.buffer*o.bar_outer_padding_percentage+i/2}).attr("y",v(o)).attr("dy",".35em").attr("text-anchor","middle").text(String),o.truncate_x_labels&&s.each(function(t,e){var r=o.scales.X.bandwidth();X(this,t,r)}),l(s,o.rotate_x_labels)),this;var a,o,i,s},MG.init=Ft,MG.markers=Lt;var Bt=function(a,o){return function(n){return["x","y"].every(function(t){return!(t in o)||(e=n[a[t+"_accessor"]],r=o[t],e>Math.min(r[0],r[1])&&e<Math.max(r[0],r[1]));var e,r})}},It=function(e,r){var t=e.processed.raw_data||e.data;"raw_data"in e.processed||(e.processed.raw_domain={x:e.scales.X.domain(),y:e.scales.Y.domain()},e.processed.raw_data=t),["x","y"].some(function(t){return r[t][0]===r[t][1]})||"point"===e.chart_type&&(n(t)?e.data=t.map(function(t){return t.filter(Bt(e,r))}):e.data=t.filter(Bt(e,r)),0===h(e.data).length)||(["x","y"].forEach(function(t){t in r?e.processed["zoom_"+t]=r[t]:delete e.processed["zoom_"+t]}),e.processed.subplot&&(r!==e.processed.raw_domain?MG.create_brushing_pattern(e.processed.subplot,qt(e.processed.subplot,r)):MG.remove_brushing_pattern(e.processed.subplot)),new MG.charts[e.chart_type||defaults.chart_type].descriptor(e))},Ht=function(r,n){return["x","y"].reduce(function(t,e){return e in n&&(t[e]=n[e].map(function(t){return+r.scales[e.toUpperCase()].invert(t)}),"y"===e&&t[e].reverse()),t},{})},qt=function(r,n){return["x","y"].reduce(function(t,e){return e in n&&(t[e]=n[e].map(function(t){return+r.scales[e.toUpperCase()](t)}),"y"===e&&t[e].reverse()),t},{})};MG.convert_range_to_domain=Ht,MG.zoom_to_data_domain=It,MG.zoom_to_data_range=function(t,e){var r=Ht(t,e);It(t,r)},MG.zoom_to_raw_range=function(t){"raw_domain"in t.processed&&(It(t,t.processed.raw_domain),delete t.processed.raw_domain,delete t.processed.raw_data)};var Vt=function(t){return E.select(t.target).select(".mg-extent").size()?E.select(t.target).select(".mg-extent"):E.select(t.target).select(".mg-rollover-rect, .mg-voronoi").insert("g","*").classed("mg-brush",!0).append("rect").classed("mg-extent",!0)},Wt=function(t,e){var r=e.x[0],n=e.x[1]-e.x[0],a=e.y[0],o=e.y[1]-e.y[0];Vt(t).attr("x",r).attr("width",n).attr("y",a).attr("height",o).attr("opacity",1)},Qt=function(t){Vt(t).attr("width",0).attr("height",0).attr("opacity",0)};MG.add_brush_function=function(t){if("categorical"===t.x_axis_type||"categorical"===t.y_axis_type)return console.warn('The option "brush" does not support axis type "categorical" currently.');t.zoom_target||(t.zoom_target=t),t.zoom_target!==t&&(t.zoom_target.processed.subplot=t);var i,r,s,n,e,c,a,o,l,u,f=void 0;switch(t.brush){case"x":f={x:!0,y:!1};break;case"y":f={x:!1,y:!0};break;case"xy":f={x:!0,y:!0};break;default:f={x:!0,y:!0}}r=(i=t).zoom_target,s=f,n=E.select(i.target).select("svg"),e=n.select(".mg-rollover-rect, .mg-voronoi"),c=e.node(),o=a=!1,l=[],u=function(){var t=i.left,e=i.width-i.right-i.buffer,r=i.top,n=i.height-i.bottom-i.buffer,a=E.mouse(c),o={};return o.x=s.x?[Math.max(t,Math.min(l[0],a[0])),Math.min(e,Math.max(l[0],a[0]))]:[t,e],o.y=s.y?[Math.max(r,Math.min(l[1],a[1])),Math.min(n,Math.max(l[1],a[1]))]:[r,n],o},e.classed("mg-brush-container",!0),e.on("mousedown."+i.target,function(){a=!(o=!0),l=E.mouse(c),n.classed("mg-brushed",!1),n.classed("mg-brushing-in-progress",!0),Qt(i)}),E.select(document).on("mousemove."+i.target,function(){o&&(a=!0,e.classed("mg-brushing",!0),Wt(i,u()))}),E.select(document).on("mouseup."+i.target,function(){if(o){o=!1,n.classed("mg-brushing-in-progress",!1);var t=u();if(a)if(a=!1,r===i)MG.zoom_to_data_range(r,t),i.click_to_zoom_out&&n.select(".mg-rollover-rect, .mg-voronoi").classed("mg-brushed",!0);else{var e=MG.convert_range_to_domain(i,t);MG.zoom_to_data_domain(r,e)}else i.click_to_zoom_out&&MG.zoom_to_raw_range(r);R(i.brushing_selection_changed)&&i.brushing_selection_changed(i,t)}})},MG.create_brushing_pattern=Wt,MG.remove_brushing_pattern=Qt;var Zt=new function(){var t,i=[];function s(){i.forEach(function(t){var e=E.select(t).select("svg");if(!e.empty()&&(0<e.node().parentNode.offsetWidth||0<e.node().parentNode.offsetHeight)){var r=0!==e.attr("width")?e.attr("height")/e.attr("width"):0,n=d(t);e.attr("width",n),e.attr("height",r*n)}})}return"undefined"!=typeof MutationObserver?t=MutationObserver:"undefined"!=typeof WebKitMutationObserver&&(t=WebKitMutationObserver),{add_target:function(a){if(0===i.length&&window.addEventListener("resize",s,!0),-1===i.indexOf(a)&&(i.push(a),t)){var o=new t(function(t){var e,r,n=E.select(a).node();n&&!t.some(function(t){for(var e=0;e<t.removedNodes.length;e++)if(t.removedNodes[e]===n)return!0})||(o.disconnect(),e=a,-1!==(r=i.indexOf(e))&&i.splice(r,1),0===i.length&&window.removeEventListener("resize",s,!0))});o.observe(E.select(a).node().parentNode,{childList:!0})}}}};function Kt(t){var e;((e=t).full_width||e.full_height)&&Zt.add_target(e.target)}k()&&function(s){if("function"==typeof s().dropdown)return;var c='[data-toggle="dropdown"]',n=function(t){s(t).on("click.bs.dropdown",this.toggle)};function o(n){n&&3===n.which||(s(".dropdown-backdrop").remove(),s(c).each(function(){var t=s(this),e=l(t),r={relatedTarget:this};e.hasClass("open")&&(e.trigger(n=s.Event("hide.bs.dropdown",r)),n.isDefaultPrevented()||(t.attr("aria-expanded","false"),e.removeClass("open").trigger("hidden.bs.dropdown",r)))}))}function l(t){var e=t.attr("data-target");e||(e=(e=t.attr("href"))&&/#[A-Za-z]/.test(e)&&e.replace(/.*(?=#[^\s]*$)/,""));var r=e&&s(e);return r&&r.length?r:t.parent()}n.VERSION="3.3.1",n.prototype.toggle=function(t){var e=s(this);if(!e.is(".disabled, :disabled")){var r=l(e),n=r.hasClass("open");if(o(),!n){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&s('<div class="dropdown-backdrop"/>').insertAfter(s(this)).on("click",o);var a={relatedTarget:this};if(r.trigger(t=s.Event("show.bs.dropdown",a)),t.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),r.toggleClass("open").trigger("shown.bs.dropdown",a)}return!1}},n.prototype.keydown=function(t){if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)){var e=s(this);if(t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled")){var r=l(e),n=r.hasClass("open");if(!n&&27!=t.which||n&&27==t.which)return 27==t.which&&r.find(c).trigger("focus"),e.trigger("click");var a=" li:not(.divider):visible a",o=r.find('[role="menu"]'+a+', [role="listbox"]'+a);if(o.length){var i=o.index(t.target);38==t.which&&0<i&&i--,40==t.which&&i<o.length-1&&i++,~i||(i=0),o.eq(i).trigger("focus")}}}};var t=s.fn.dropdown;s.fn.dropdown=function(r){return this.each(function(){var t=s(this),e=t.data("bs.dropdown");e||t.data("bs.dropdown",e=new n(this)),"string"==typeof r&&e[r].call(t)})},s.fn.dropdown.Constructor=n,s.fn.dropdown.noConflict=function(){return s.fn.dropdown=t,this},s(document).on("click.bs.dropdown.data-api",o).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",c,n.prototype.toggle).on("keydown.bs.dropdown.data-api",c,n.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',n.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',n.prototype.keydown)}(jQuery),MG.button_layout=function(t){return this.target=t,this.feature_set={},this.public_name={},this.sorters={},this.manual=[],this.manual_map={},this.manual_callback={},this._strip_punctuation=function(t){return t.replace(/[^a-zA-Z0-9 _]+/g,"").replace(/ +?/g,"")},this.data=function(t){return this._data=t,this},this.manual_button=function(t,e,r){return this.feature_set[t]=e,this.manual_map[this._strip_punctuation(t)]=t,this.manual_callback[t]=r,this},this.button=function(t){return 1<arguments.length&&(this.public_name[t]=arguments[1]),2<arguments.length&&(this.sorters[t]=arguments[2]),this.feature_set[t]=[],this},this.callback=function(t){return this._callback=t,this},this.display=function(){var e,t,r,n,a=this._callback,o=this.manual_callback,i=this.manual_map;r=Object.keys(this.feature_set);var s,c=function(t){return e[t]};for(s=0;s<this._data.length;s++){e=this._data[s],t=r.map(c);for(var l=0;l<r.length;l++)n=r[l],-1===this.feature_set[n].indexOf(t[l])&&this.feature_set[n].push(t[l])}for(n in this.feature_set)this.sorters.hasOwnProperty(n)&&this.feature_set[n].sort(this.sorters[n]);$(this.target).empty(),$(this.target).append("<div class='col-lg-12 segments text-center'></div>");var u=function(){var t,e=$(this).data("key"),r=$(this).data("feature");return $("."+r+"-btns button.btn span.title").html(e),i.hasOwnProperty(r)?(t=i[r],o[t](e)):a(r,e),!1};for(var f in this.feature_set){for(r=this.feature_set[f],$(this.target+" div.segments").append('<div class="btn-group '+this._strip_punctuation(f)+'-btns text-left"><button type="button" class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown"><span class=\'which-button\'>'+(this.public_name.hasOwnProperty(f)?this.public_name[f]:f)+"</span><span class='title'>"+(this.manual_callback.hasOwnProperty(f)?this.feature_set[f][0]:"all")+'</span><span class="caret"></span></button><ul class="dropdown-menu" role="menu">'+(this.manual_callback.hasOwnProperty(f)?"":'<li><a href="#" data-feature="'+f+'" data-key="all">All</a></li>')+(this.manual_callback.hasOwnProperty(f)?"":'<li class="divider"></li>')+"</ul></div>"),s=0;s<r.length;s++)"all"!==r[s]&&void 0!==r[s]&&$(this.target+" div."+this._strip_punctuation(f)+"-btns ul.dropdown-menu").append('<li><a href="#" data-feature="'+this._strip_punctuation(f)+'" data-key="'+r[s]+'">'+r[s]+"</a></li>");$("."+this._strip_punctuation(f)+"-btns .dropdown-menu li a").on("click",u)}return this},this};var Jt=function(t,e,r){var n=r.color,a=r.colors;t.classed("mg-hover-line-color",null===n).classed("mg-hover-line"+e+"-color",null===a).attr("fill",null===a?"":a[e-1])},te=function(r,t,e){t.existing_band=e.selectAll(".mg-confidence-band").nodes(),r.show_confidence_band&&(t.confidence_area=E.area().defined(t.line.defined()).x(r.scalefns.xf).y0(function(t){var e=r.show_confidence_band[0];return null!=t[e]?r.scales.Y(t[e]):r.scales.Y(t[r.y_accessor])}).y1(function(t){var e=r.show_confidence_band[1];return null!=t[e]?r.scales.Y(t[e]):r.scales.Y(t[r.y_accessor])}).curve(r.interpolate))},ee=function(t,e){var r=t.scalefns,n=t.scales,a=t.interpolate,o=t.flip_area_under_y_value,i=Number.isFinite(o)?n.Y(o):n.Y.range()[0];e.area=E.area().defined(e.line.defined()).x(r.xf).y0(function(){return i}).y1(r.yf).curve(a)},re=function(t,e){var r=t.y_accessor,n=t.scalefns,a=t.scales,o=t.interpolate;e.flat_line=E.line().defined(function(t){return(void 0===t._missing||!0!==t._missing)&&null!==t[r]}).x(n.xf).y(function(){return a.Y(e.data_median)}).curve(o)},ne=function(t,e){var r=t.scalefns,n=t.interpolate,a=t.missing_is_zero,o=t.y_accessor;e.line=E.line().x(r.xf).y(r.yf).curve(n),a||(e.line=e.line.defined(function(t){return(void 0===t._missing||!0!==t._missing)&&null!==t[o]}))},ae=function(t,e,r,n){var a=t.show_confidence_band,o=t.transition_on_update,i=t.data,s=t.target;if(a){r.select(".mg-confidence-band-"+n).empty()&&r.append("path").attr("class","mg-confidence-band mg-confidence-band-"+n),r.select(".mg-confidence-band-"+n).transition().duration(function(){return o?1e3:0}).attr("d",e.confidence_area(i[n-1])).attr("clip-path","url(#mg-plot-window-"+z(s)+")")}},oe=function(t,e,r,n,a){var o=t.data,i=t.target,s=t.colors,c=r.selectAll(".mg-main-area.mg-area"+a);e.display_area?c.empty()?r.append("path").classed("mg-main-area",!0).classed("mg-area"+a,!0).classed("mg-area-color",null===s).classed("mg-area"+a+"-color",null===s).attr("d",e.area(o[n])).attr("fill",null===s?"":s[a-1]).attr("clip-path","url(#mg-plot-window-"+z(i)+")"):(r.node().appendChild(c.node()),c.transition().duration(e.update_transition_duration).attr("d",e.area(o[n])).attr("clip-path","url(#mg-plot-window-"+z(i)+")")):c.empty()||c.remove()},ie=function(t,e){t.classed("mg-line-color",!0).classed("mg-line"+e+"-color",!0)},se=function(t,e,r,n,a,o){if(n.empty()){var i=r.append("path").attr("class","mg-main-line mg-line"+o);g=i,h=a,x=o,(y=t.colors)&&y.constructor===Array?(g.attr("stroke",y[h]),y.length<h+1&&ie(g,x)):ie(g,x),l=e,u=i,f=a,d=(c=t).animate_on_load,p=c.data,_=c.y_accessor,m=c.target,d?(l.data_median=E.median(p[f],function(t){return t[_]}),u.attr("d",l.flat_line(p[f])).transition().duration(1e3).attr("d",l.line(p[f])).attr("clip-path","url(#mg-plot-window-"+z(m)+")")):u.attr("d",l.line(p[f])).attr("clip-path","url(#mg-plot-window-"+z(m)+")")}else{r.node().appendChild(n.node());var s=n.transition().duration(e.update_transition_duration);e.display_area||!t.transition_on_update||t.missing_is_hidden?s.attr("d",e.line(t.data[a])):s.attrTween("d",Ne(e.line(t.data[a]),4))}var c,l,u,f,d,p,_,m,g,h,x,y},ce=function(t,e,r,n){var a,o=void 0;if(t.legend)if(u(t.legend)?o=t.legend[r]:(a=t.legend,"[object Function]"===Object.prototype.toString.call(a)&&(o=t.legend(t.data[r]))),t.legend_target)t.colors&&t.colors.constructor===Array?e.legend_text="<span style='color:"+t.colors[r]+"'>&mdash; "+o+"&nbsp; </span>"+e.legend_text:e.legend_text="<span class='mg-line"+n+"-legend-color'>&mdash; "+o+"&nbsp; </span>"+e.legend_text;else{var i=void 0,s=void 0,c=void 0;c="left"===t.y_axis_position?(i=t.data[r][t.data[r].length-1],s="start",t.buffer):(i=t.data[r][0],s="end",-t.buffer);var l=e.legend_group.append("svg:text").attr("x",t.scalefns.xf(i)).attr("dx",c).attr("y",t.scalefns.yf(i)).attr("dy",".35em").attr("font-size",10).attr("text-anchor",s).attr("font-weight","300").text(o);t.colors&&t.colors.constructor===Array?t.colors.length<r+1?l.classed("mg-line"+n+"-legend-color",!0):l.attr("fill",t.colors[r]):l.classed("mg-line-legend-color",!0).classed("mg-line"+n+"-legend-color",!0),function(t,e){if(t&&1!=t.length){var r,n,a;t.sort(function(t,e){return E.select(e).attr("y")-E.select(t).attr("y")}),t.reverse();for(var o=0;o<t.length;o++){n=E.select(t[o]).text();for(var i=0;i<t.length;i++)if(a=E.select(t[i]).text(),!1!==(l=t[o],u=t[i],void 0,f=l.getBoundingClientRect(),d=u.getBoundingClientRect(),r=f.top<=d.bottom&&f.top>=d.top&&d.bottom-f.top)&&n!==a){var s=E.select(t[o]),c=+s.attr("y");c+=r,s.attr("y",c)}}}var l,u,f,d}(e.legend_group.selectAll(".mg-line-legend text").nodes())}},le=function(e,t,r,n,a,o){var i,s,c,l=E.voronoi().x(function(t){return e.scales.X(t[e.x_accessor]).toFixed(2)}).y(function(t){return e.scales.Y(t[e.y_accessor]).toFixed(2)}).extent([[e.buffer,e.buffer+(e.title?e.title_y_position:0)],[e.width-e.buffer,e.height-e.buffer]]);S(t,"mg-voronoi").selectAll("path").data(l.polygons((s=e,c=s.data,E.merge(c)))).enter().append("path").filter(function(t){return void 0!==t&&0<t.length}).attr("d",function(t){return null==t?null:"M"+t.join("L")+"Z"}).datum(function(t){return null==t?null:t.data}).attr("class",(i=e,function(t){var e=void 0;if(i.linked){var r=t[i.x_accessor],n=MG.time_format(i.utc_time,i.linked_format);return e="roll_"+("number"==typeof r?t.__line_id__-1:n(r))+" mg-line"+t.__line_id__,null===i.color&&(e+=" mg-line"+t.__line_id__+"-color"),e}return e="mg-line"+t.__line_id__,null===i.color&&(e+=" mg-line"+t.__line_id__+"-color"),e})).on("click",o).on("mouseover",r).on("mouseout",n).on("mousemove",a),fe(e,t)},ue=function(n,t,e,r,a,o){var i,s,c,l,u,f=(s=(i=n).x_accessor,c=i.data,l=i.x_sort,(u=E.nest().key(function(t){return t[s]}).entries(E.merge(c))).forEach(function(t){var e=t.values[0];t.key=e[s]}),l?u.sort(function(t,e){return new Date(t.key)-new Date(e.key)}):u),d=f.map(function(t){var e=t.key;return n.scales.X(e)});t.append("g").attr("class","mg-rollover-rect").selectAll(".mg-rollover-rects").data(f).enter().append("rect").attr("x",function(t,e){return 1===d.length?Y(n):0===e?d[e].toFixed(2):((d[e-1]+d[e])/2).toFixed(2)}).attr("y",n.top).attr("width",function(t,e){return 1===d.length?P(n):0===e?((d[e+1]-d[e])/2).toFixed(2):e===d.length-1?((d[e]-d[e-1])/2).toFixed(2):((d[e+1]-d[e-1])/2).toFixed(2)}).attr("class",function(t){var e=t.values,r=e.map(function(t){var e=t.__line_id__,r=de(e);return null===n.colors&&(r+=" "+pe(e)),r}).join(" ");return n.linked&&0<e.length&&(r+=" "+_e(me(e[0],n))),r}).attr("height",n.height-n.bottom-n.top-n.buffer).attr("opacity",0).on("click",o).on("mouseover",e).on("mouseout",r).on("mousemove",a),ge(n,t)},fe=function(t,e){for(var r=t.data,n=t.custom_line_color_map,a=0;a<r.length;a++){var o=a+1;0<n.length&&void 0!==n[a]&&(o=n[a]),1!==r[a].length||e.selectAll(".mg-voronoi .mg-line"+o).empty()||(e.selectAll(".mg-voronoi .mg-line"+o).on("mouseover")(r[a][0],0),e.selectAll(".mg-voronoi .mg-line"+o).on("mouseout")(r[a][0],0))}},de=function(t){return"mg-line"+t},pe=function(t){return"mg-line"+t+"-color"},_e=function(t){return"roll_"+t},me=function(t,e){var r=e.x_accessor,n=e.utc_time,a=e.linked_format,o=t[r],i=MG.time_format(n,a);return"number"==typeof o?o.toString().replace(".","_"):i(o)},ge=function(t,e){var r=t.data,n=e.selectAll(".mg-rollover-rect rect"),a=n.nodes()[0][0]||n.nodes()[0];0<r.filter(function(t){return 1===t.length}).length&&n.on("mouseover")(a.__data__,0)},he=function(t){var e=t.data;return 1===e.length&&1===e[0].length},xe=function(t,e){var r=t.existing_band;r[0]&&r[0].length>e.selectAll(".mg-main-line").node().length&&e.selectAll(".mg-confidence-band").remove()},ye=function(t){var e,r,n,a,o,i,s,c={},l=O(t.target);D(l,".mg-line-legend"),e=c,r=l,t.legend&&(e.legend_group=S(r,"mg-line-legend")),c.data_median=0,c.update_transition_duration=t.transition_on_update?1e3:0,c.display_area=t.area&&!t.use_data_y_min&&t.data.length<=1&&!1===t.aggregate_rollover||Array.isArray(t.area)&&0<t.area.length,c.legend_text="",o=l,ne(n=t,a=c),ee(n,a),re(n,a),te(n,a,o),c.existing_band=l.selectAll(".mg-confidence-band").nodes(),!1!==MG.call_hook("line.before_all_series",[t])&&function(e,t,r){xe(t,r),e.active_point_on_lines&&r.selectAll("circle.mg-shown-active-point").remove();for(var n=e.data.length-1;0<=n;n--){var a=e.data[n];MG.call_hook("line.before_each_series",[a,e]);var o=n+1;0<e.custom_line_color_map.length&&(o=e.custom_line_color_map[n]),e.data[n].__line_id__=o,e.active_point_on_lines&&r.selectAll("circle-"+o).data(e.data[n]).enter().filter(function(t){return t[e.active_point_accessor]}).append("circle").attr("class","mg-area"+o+"-color mg-shown-active-point").attr("cx",e.scalefns.xf).attr("cy",e.scalefns.yf).attr("r",function(){return e.active_point_size});var i=r.select("path.mg-main-line.mg-line"+o);0!==a.length?(ae(e,t,r,o),Array.isArray(e.area)?e.area[o-1]&&oe(e,t,r,n,o):oe(e,t,r,n,o),se(e,t,r,i,n,o),ce(e,t,n,o),MG.call_hook("line.after_each_series",[a,i,e])):i.remove()}}(t,c,l),i=t.legend_target,s=c.legend_text,i&&E.select(i).html(s)},ve=function(t,e){var r,n,a,o,i,s,c,l,u,f,d,p,_=O(t.target);t.showActivePoint&&0===_.selectAll(".mg-active-datapoint-container").nodes().length&&S(_,"mg-active-datapoint-container"),D(r=_,".mg-rollover-rect"),D(r,".mg-voronoi"),D(r,".mg-active-datapoint"),D(r,".mg-line-rollover-circle"),a=_,o=(n=t).data,i=n.colors,s=a.selectAll(".mg-line-rollover-circle").data(o).enter().append("circle").attr("cx",0).attr("cy",0).attr("r",0),i&&i.constructor===Array?s.attr("class",function(t){return"mg-line"+t.__line_id__}).attr("fill",function(t,e){return i[e]}).attr("stroke",function(t,e){return i[e]}):s.attr("class",function(t,e){var r=t.__line_id__;return["mg-line"+r,"mg-line"+r+"-color","mg-area"+r+"-color"].join(" ")}),s.classed("mg-line-rollover-circle",!0),function(t){for(var r=t.data,n=t.custom_line_color_map,e=function(e){r[e].forEach(function(t){t.__index__=e+1,t.__line_id__=0<n.length?n[e]:e+1})},a=0;a<r.length;a++)e(a)}(t),d=(f=t).data,p=f.aggregate_rollover,1<d.length&&!p?le(t,_,e.rolloverOn(t),e.rolloverOff(t),e.rolloverMove(t),e.rolloverClick(t)):(l=(c=t).data,u=c.aggregate_rollover,1<l.length&&u?ue(t,_,e.rolloverOn(t),e.rolloverOff(t),e.rolloverMove(t),e.rolloverClick(t)):function(n,t,e,r,a,o){var i=1;0<n.custom_line_color_map.length&&(i=n.custom_line_color_map[0]);var s,c,l=t.append("g").attr("class","mg-rollover-rect"),u=n.data[0].map(n.scalefns.xf);l.selectAll(".mg-rollover-rects").data(n.data[0]).enter().append("rect").attr("class",function(t,e){var r=pe(i)+" "+de(t.__line_id__);return n.linked&&(r+=r+" "+_e(me(t,n))),r}).attr("x",function(t,e){return 1===u.length?Y(n):0===e?u[e].toFixed(2):((u[e-1]+u[e])/2).toFixed(2)}).attr("y",function(t,e){return 1<n.data.length?n.scalefns.yf(t)-6:n.top}).attr("width",function(t,e){return 1===u.length?P(n):0===e?((u[e+1]-u[e])/2).toFixed(2):e===u.length-1?((u[e]-u[e-1])/2).toFixed(2):((u[e+1]-u[e-1])/2).toFixed(2)}).attr("height",function(t,e){return 1<n.data.length?12:n.height-n.bottom-n.top-n.buffer}).attr("opacity",0).on("click",o).on("mouseover",e).on("mouseout",r).on("mousemove",a),he(n)&&(s=t,c=n.data,s.select(".mg-rollover-rect rect").on("mouseover")(c[0][0],0))}(t,_,e.rolloverOn(t),e.rolloverOff(t),e.rolloverMove(t),e.rolloverClick(t)))},be=function(t,e,r){var n=t.scales,a=t.x_accessor,o=t.y_accessor,i=t.point_size;e.select("circle.mg-line-rollover-circle.mg-line"+r.__line_id__).attr("cx",n.X(r[a]).toFixed(2)).attr("cy",n.Y(r[o]).toFixed(2)).attr("r",i).style("opacity",1)},we=function(t,e,r){var n=t.scales,a=t.x_accessor,o=t.y_accessor,i=t.point_size;e.selectAll("circle.mg-line-rollover-circle.mg-line"+r.__line_id__).classed("mg-line-rollover-circle",!0).attr("cx",function(){return n.X(r[a]).toFixed(2)}).attr("cy",function(){return n.Y(r[o]).toFixed(2)}).attr("r",i).style("opacity",1)};MG.register("line",function(t){this.init=function(e){if(!(this.args=e).data||0===e.data.length)return e.internal_error="No data was supplied",t=e,console.error("INTERNAL ERROR : ",t.target," : ",t.internal_error),this;var t;e.internal_error=void 0,Ae(e),Oe(e),MG.call_hook("line.before_destroy",this),Ft(e),new MG.scale_factory(e).namespace("x").numericalDomainFromData().numericalRange("bottom");var r=(e.baselines||[]).map(function(t){return t[e.y_accessor]});return new MG.scale_factory(e).namespace("y").zeroBottom(!0).inflateDomain(!0).numericalDomainFromData(r).numericalRange("left"),e.x_axis&&new MG.axis_factory(e).namespace("x").type("numerical").position(e.x_axis_position).rug(it(e)).label(lt).draw(),e.y_axis&&new MG.axis_factory(e).namespace("y").type("numerical").position(e.y_axis_position).rug(tt(e)).label(nt).draw(),this.markers(),this.mainPlot(),this.rollover(),this.windowListeners(),e.brush&&MG.add_brush_function(e),MG.call_hook("line.after_init",this),this},this.mainPlot=function(){return ye(t),this},this.markers=function(){return Lt(t),this},this.rollover=function(){return ve(t,this),MG.call_hook("line.after_rollover",t),this},this.rolloverClick=function(r){return function(t,e){r.click&&r.click(t,e)}},this.rolloverOn=function(a){var o=O(a.target);return function(r,t){if(function(n,a,t){if(n.aggregate_rollover&&1<n.data.length)a.selectAll("circle.mg-line-rollover-circle").style("opacity",0),t.values.forEach(function(t,e,r){n.missing_is_hidden&&r[e]._missing||i(t,n)&&be(n,a,t)});else{if(n.missing_is_hidden&&t._missing||null===t[n.y_accessor])return;i(t,n)&&we(n,a,t)}}(a,o,r),function(t,e,r){if(t.linked&&!MG.globals.link&&(MG.globals.link=!0,!t.aggregate_rollover||void 0!==e[t.y_accessor]||e.values&&0<e.values.length)){var n=e.values?e.values[0]:e,a=me(n,t);E.selectAll("."+de(n.__line_id__)+"."+_e(a)).each(function(t){E.select(this).on("mouseover")(t,r)})}}(a,r,t),o.selectAll("text").filter(function(t,e){return r===t}).attr("opacity",.3),a.show_rollover_text&&!(a.missing_is_hidden&&r._missing||null===r[a.y_accessor])){var e=Ut(a,{svg:o}),n=e.mouseover_row();a.aggregate_rollover&&n.text((a.aggregate_rollover&&1<a.data.length?function(t,e){return je(t,e,t.x_mouseover,"key",t.time_series)}:Le)(a,r)),(a.aggregate_rollover&&1<a.data.length?r.values:[r]).forEach(function(t){a.aggregate_rollover&&(n=e.mouseover_row()),a.legend&&Jt(n.text(a.legend[t.__index__-1]+"  ").bold(),t.__line_id__,a),Jt(n.text("‚Äî  ").elem,t.__line_id__,a),a.aggregate_rollover||n.text(Le(a,t)),n.text(Xe(a,t,a.time_series))})}a.mouseover&&a.mouseover(r,t)}},this.rolloverOff=function(s){var c=O(s.target);return function(t,e){var r,n,a,o,i;!function(t,e,n){var r=t.linked,a=t.utc_time,o=t.linked_format,i=t.x_accessor;if(r&&MG.globals.link){MG.globals.link=!1;var s=MG.time_format(a,o);(e.values?e.values:[e]).forEach(function(t){var e=t[i],r="number"==typeof e?n:s(e);E.selectAll(".roll_"+r).each(function(t){E.select(this).on("mouseout")(t)})})}}(s,t,e),s.aggregate_rollover?c.selectAll("circle.mg-line-rollover-circle").filter(function(t){return 1<t.length}).style("opacity",0):(r=s,n=c,a=t.__line_id__,o=r.custom_line_color_map,i=r.data,n.selectAll("circle.mg-line-rollover-circle.mg-line"+a).style("opacity",function(){var t=a-1;return 0<o.length&&void 0!==o.indexOf(a)&&(t=o.indexOf(a)),1===i[t].length?1:0})),1<s.data[0].length&&Xt(c),s.mouseout&&s.mouseout(t,e)}},this.rolloverMove=function(r){return function(t,e){r.mousemove&&r.mousemove(t,e)}},this.windowListeners=function(){return Kt(this.args),this},this.init(t)});function ke(t,e,r){var n,a,o,i,s,c=Ut(t,{svg:e}).mouseover_row();if(null!==t.color_accessor&&"category"===t.color_type){var l=r[t.color_accessor];c.text(l+"  ").bold().attr("fill",t.scalefns.colorf(r))}n=t,a=c.text("‚óè   ").elem,o=r,i=n.color_accessor,s=n.scalefns,null!==i?(a.attr("fill",s.colorf(o)),a.attr("stroke",s.colorf(o))):a.classed("mg-points-mono",!0),c.text(Le(t,r)),c.text(Xe(t,r,t.time_series))}MG.register("histogram",function(r){var n=this;this.init=function(e){Ae(n.args=e),ze(e),Ft(e),new MG.scale_factory(e).namespace("x").numericalDomainFromData().numericalRange("bottom");var t=(e.baselines||[]).map(function(t){return t[e.y_accessor]});return new MG.scale_factory(e).namespace("y").zeroBottom(!0).inflateDomain(!0).numericalDomainFromData(t).numericalRange("left"),st(e),at(e),n.mainPlot(),n.markers(),n.rollover(),n.windowListeners(),n},this.mainPlot=function(){var t=O(r.target);return t.selectAll(".mg-histogram").remove(),t.append("g").attr("class","mg-histogram").selectAll(".mg-bar").data(r.data[0]).enter().append("g").attr("class","mg-bar").attr("transform",function(t){return"translate("+r.scales.X(t[r.x_accessor]).toFixed(2)+","+r.scales.Y(t[r.y_accessor]).toFixed(2)+")"}).append("rect").attr("x",1).attr("width",function(t,e){return 1===r.data[0].length?(r.scalefns.xf(r.data[0][0])-r.bar_margin).toFixed(0):e!==r.data[0].length-1?(r.scalefns.xf(r.data[0][e+1])-r.scalefns.xf(t)).toFixed(0):(r.scalefns.xf(r.data[0][1])-r.scalefns.xf(r.data[0][0])).toFixed(0)}).attr("height",function(t){return 0===t[r.y_accessor]?0:(r.height-r.bottom-r.buffer-r.scales.Y(t[r.y_accessor])).toFixed(2)}),n},this.markers=function(){return Lt(r),n},this.rollover=function(){var t=O(r.target);return 0===t.selectAll(".mg-active-datapoint-container").nodes().length&&S(t,"mg-active-datapoint-container"),t.selectAll(".mg-rollover-rect").remove(),t.selectAll(".mg-active-datapoint").remove(),t.append("g").attr("class","mg-rollover-rect").selectAll(".mg-bar").data(r.data[0]).enter().append("g").attr("class",function(t,e){return r.linked?"mg-rollover-rects roll_"+e:"mg-rollover-rects"}).attr("transform",function(t){return"translate("+r.scales.X(t[r.x_accessor])+",0)"}).append("rect").attr("x",1).attr("y",r.buffer+(r.title?r.title_y_position:0)).attr("width",function(t,e){return 1===r.data[0].length?(r.scalefns.xf(r.data[0][0])-r.bar_margin).toFixed(0):e!==r.data[0].length-1?(r.scalefns.xf(r.data[0][e+1])-r.scalefns.xf(t)).toFixed(0):(r.scalefns.xf(r.data[0][1])-r.scalefns.xf(r.data[0][0])).toFixed(0)}).attr("height",function(t){return r.height}).attr("opacity",0).on("mouseover",n.rolloverOn(r)).on("mouseout",n.rolloverOff(r)).on("mousemove",n.rolloverMove(r)),n},this.rolloverOn=function(e){var a=O(e.target);return function(r,n){if(a.selectAll("text").filter(function(t,e){return r===t}).attr("opacity",.3),e.processed.xax_format||MG.time_format(e.utc_time,"%b %e, %Y"),$e(e),a.selectAll(".mg-bar rect").filter(function(t,e){return e===n}).classed("active",!0),e.linked&&!MG.globals.link&&(MG.globals.link=!0,E.selectAll(".mg-rollover-rects.roll_"+n+" rect").each(function(t){E.select(this).on("mouseover")(t,n)})),e.show_rollover_text){var t=Ut(e,{svg:a}).mouseover_row();t.text("‚ñü  ").elem.classed("hist-symbol",!0),t.text(Le(e,r)),t.text(Xe(e,r,e.time_series))}e.mouseover&&(Nt(a,e),e.mouseover(r,n))}},this.rolloverOff=function(r){var n=O(r.target);return function(t,e){r.linked&&MG.globals.link&&(MG.globals.link=!1,E.selectAll(".mg-rollover-rects.roll_"+e+" rect").each(function(t){E.select(this).on("mouseout")(t,e)})),n.selectAll(".mg-bar rect").classed("active",!1),Xt(n),r.mouseout&&r.mouseout(t,e)}},this.rolloverMove=function(r){return function(t,e){r.mousemove&&r.mousemove(t,e)}},this.windowListeners=function(){return Kt(n.args),n},this.init(r)},{bar_margin:[1,"number"],binned:[!1,"boolean"],bins:[null,["number","number[]","function"]],processed_x_accessor:["x","string"],processed_y_accessor:["y","string"],processed_dx_accessor:["dx","string"]});var Me=function(t,e){var r=e.x_accessor,n=e.y_accessor;return t.filter(function(t){return(null===e.min_x||t[r]>=e.min_x)&&(null===e.max_x||t[r]<=e.max_x)&&(null===e.min_y||t[n]>=e.min_y)&&(null===e.max_y||t[n]<=e.max_y)})};MG.register("point",function(o){var i=this;this.init=function(e){if((this.args=e).x_axis_type=s(e,"x"),e.y_axis_type=s(e,"y"),Ae(e),Fe(e),Ft(e),"categorical"===e.x_axis_type?(MG.scale_factory(e).namespace("x").categoricalDomainFromData().categoricalRangeBands([0,e.xgroup_height],null===e.xgroup_accessor),e.xgroup_accessor?new MG.scale_factory(e).namespace("xgroup").categoricalDomainFromData().categoricalRangeBands("bottom"):(e.scales.XGROUP=function(){return Y(e)},e.scalefns.xgroupf=function(){return Y(e)}),e.scalefns.xoutf=function(t){return e.scalefns.xf(t)+e.scalefns.xgroupf(t)}):(MG.scale_factory(e).namespace("x").inflateDomain(!0).zeroBottom("categorical"===e.y_axis_type).numericalDomainFromData((e.baselines||[]).map(function(t){return t[e.x_accessor]})).numericalRange("bottom"),e.scalefns.xoutf=e.scalefns.xf),"categorical"===e.y_axis_type)MG.scale_factory(e).namespace("y").zeroBottom(!0).categoricalDomainFromData().categoricalRangeBands([0,e.ygroup_height],!0),e.ygroup_accessor?new MG.scale_factory(e).namespace("ygroup").categoricalDomainFromData().categoricalRangeBands("left"):(e.scales.YGROUP=function(){return b(e)},e.scalefns.ygroupf=function(){return b(e)}),e.scalefns.youtf=function(t){return e.scalefns.yf(t)+e.scalefns.ygroupf(t)};else{var t=(e.baselines||[]).map(function(t){return t[e.y_accessor]});MG.scale_factory(e).namespace("y").inflateDomain(!0).zeroBottom("categorical"===e.x_axis_type).numericalDomainFromData(t).numericalRange("left"),e.scalefns.youtf=function(t){return e.scalefns.yf(t)}}if(null!==e.color_accessor){var r=MG.scale_factory(e).namespace("color");"number"===e.color_type?r.numericalDomainFromData(H(e)).numericalRange(q(e)).clamp(!0):e.color_domain?r.categoricalDomain(e.color_domain).categoricalRange(e.color_range):r.categoricalDomainFromData().categoricalColorRange()}return e.size_accessor&&new MG.scale_factory(e).namespace("size").numericalDomainFromData().numericalRange(ct(e)).clamp(!0),new MG.axis_factory(e).namespace("x").type(e.x_axis_type).zeroLine("categorical"===e.y_axis_type).position(e.x_axis_position).rug(it(e)).label(lt).draw(),new MG.axis_factory(e).namespace("y").type(e.y_axis_type).zeroLine("categorical"===e.x_axis_type).position(e.y_axis_position).rug(tt(e)).label(nt).draw(),this.mainPlot(),this.markers(),this.rollover(),this.windowListeners(),e.brush&&MG.add_brush_function(e),this},this.markers=function(){return Lt(o),o.least_squares&&Ce(o),this},this.mainPlot=function(){var t=O(o.target),e=Me(o.data[0],o);t.selectAll(".mg-points").remove();var r=t.append("g").classed("mg-points",!0).selectAll("circle").data(e).enter().append("circle").attr("class",function(t,e){return"path-"+e}).attr("cx",o.scalefns.xoutf).attr("cy",function(t){return o.scalefns.youtf(t)}),n=void 0;t.selectAll(".mg-highlight").remove(),o.highlight&&R(o.highlight)&&(n=t.append("g").classed("mg-highlight",!0).selectAll("circle").data(e.filter(o.highlight)).enter().append("circle").attr("cx",o.scalefns.xoutf).attr("cy",function(t){return o.scalefns.youtf(t)}));var a=[r].concat(n?[n]:[]);return null!==o.color_accessor?a.forEach(function(t){return t.attr("fill",o.scalefns.colorf).attr("stroke",o.scalefns.colorf)}):a.forEach(function(t){return t.classed("mg-points-mono",!0)}),r.attr("r",null!==o.size_accessor?o.scalefns.sizef:o.point_size),n&&n.attr("r",null!==o.size_accessor?function(t,e){return o.scalefns.sizef(t,e)+2}:o.point_size+2),this},this.rollover=function(){var t=O(o.target);0===t.selectAll(".mg-active-datapoint-container").nodes().length&&S(t,"mg-active-datapoint-container"),t.selectAll(".mg-voronoi").remove();var e=E.voronoi().x(o.scalefns.xoutf).y(o.scalefns.youtf).extent([[o.buffer,o.buffer+(o.title?o.title_y_position:0)],[o.width-o.buffer,o.height-o.buffer]]);return t.append("g").attr("class","mg-voronoi").selectAll("path").data(e.polygons(Me(o.data[0],o))).enter().append("path").attr("d",function(t){return null==t?null:"M"+t.join(",")+"Z"}).attr("class",function(t,e){return"path-"+e}).style("fill-opacity",0).on("click",this.rolloverClick(o)).on("mouseover",this.rolloverOn(o)).on("mouseout",this.rolloverOff(o)).on("mousemove",this.rolloverMove(o)),1===o.data[0].length&&ke(o,t,o.data[0][0]),this},this.rolloverClick=function(r){return function(t,e){r.click&&r.click(t,e)}},this.rolloverOn=function(n){var a=O(n.target);return function(t,e){a.selectAll(".mg-points circle").classed("selected",!1);var r=a.selectAll(".mg-points circle.path-"+e).classed("selected",!0);n.size_accessor?r.attr("r",function(t){return n.scalefns.sizef(t)+n.active_point_size_increase}):r.attr("r",n.point_size+n.active_point_size_increase),n.linked&&!MG.globals.link&&(MG.globals.link=!0,E.selectAll(".mg-voronoi .path-"+e).each(function(){E.select(i).on("mouseover")(t,e)})),n.show_rollover_text&&ke(n,a,t.data),n.mouseover&&n.mouseover(t,e)}},this.rolloverOff=function(n){var a=O(n.target);return function(t,e){n.linked&&MG.globals.link&&(MG.globals.link=!1,E.selectAll(".mg-voronoi .path-"+e).each(function(){E.select(i).on("mouseout")(t,e)}));var r=a.selectAll(".mg-points circle").classed("unselected",!1).classed("selected",!1);n.size_accessor?r.attr("r",n.scalefns.sizef):r.attr("r",n.point_size),1<n.data[0].length&&Xt(a),n.mouseout&&n.mouseout(t,e)}},this.rolloverMove=function(r){return function(t,e){r.mousemove&&r.mousemove(t,e)}},this.update=function(t){return this},this.windowListeners=function(){return Kt(this.args),this},this.init(o)},{color_accessor:[null,"string"],color_range:[null,"array"],color_type:["number",["number","category"]],point_size:[2.5,"number"],size_accessor:[null,"string"],size_range:[null,"array"],lowess:[!1,"boolean"],least_squares:[!1,"boolean"],y_categorical_show_guides:[!0,"boolean"],x_categorical_show_guides:[!0,"boolean"],buffer:[16,"string"],label_accessor:[null,"boolean"],size_domain:[null,"array"],color_domain:[null,"array"],active_point_size_increase:[1,"number"],highlight:[null,"function"]});MG.register("bar",function(M){var G=this;this.args=M,this.init=function(e){if((G.args=e).x_axis_type=s(e,"x"),e.y_axis_type=s(e,"y"),"categorical"==e.x_axis_type?e.orientation="vertical":"categorical"==e.y_axis_type?e.orientation="horizontal":"categorical"!=e.x_axis_type&&"categorical"!=e.y_axis_type&&(e.orientation="vertical"),Ae(e),Fe(e),Ft(e),"categorical"===e.x_axis_type?(MG.scale_factory(e).namespace("x").categoricalDomainFromData().categoricalRangeBands([0,e.xgroup_height],null===e.xgroup_accessor),e.xgroup_accessor?new MG.scale_factory(e).namespace("xgroup").categoricalDomainFromData().categoricalRangeBands("bottom"):(e.scales.XGROUP=function(t){return Y(e)},e.scalefns.xgroupf=function(t){return Y(e)}),e.scalefns.xoutf=function(t){return e.scalefns.xf(t)+e.scalefns.xgroupf(t)}):(MG.scale_factory(e).namespace("x").inflateDomain(!0).zeroBottom("categorical"===e.y_axis_type).numericalDomainFromData((e.baselines||[]).map(function(t){return t[e.x_accessor]})).numericalRange("bottom"),e.scalefns.xoutf=e.scalefns.xf),"categorical"===e.y_axis_type)MG.scale_factory(e).namespace("y").zeroBottom(!0).categoricalDomainFromData().categoricalRangeBands([0,e.ygroup_height],!0),e.ygroup_accessor?new MG.scale_factory(e).namespace("ygroup").categoricalDomainFromData().categoricalRangeBands("left"):(e.scales.YGROUP=function(){return b(e)},e.scalefns.ygroupf=function(t){return b(e)}),e.scalefns.youtf=function(t){return e.scalefns.yf(t)+e.scalefns.ygroupf(t)};else{var t=(e.baselines||[]).map(function(t){return t[e.y_accessor]});MG.scale_factory(e).namespace("y").inflateDomain(!0).zeroBottom("categorical"===e.x_axis_type).numericalDomainFromData(t).numericalRange("left"),e.scalefns.youtf=function(t){return e.scalefns.yf(t)}}return null!==e.ygroup_accessor&&(e.ycolor_accessor=e.y_accessor,MG.scale_factory(e).namespace("ycolor").scaleName("color").categoricalDomainFromData().categoricalColorRange()),null!==e.xgroup_accessor&&(e.xcolor_accessor=e.x_accessor,MG.scale_factory(e).namespace("xcolor").scaleName("color").categoricalDomainFromData().categoricalColorRange()),new MG.axis_factory(e).namespace("x").type(e.x_axis_type).zeroLine("categorical"===e.y_axis_type).position(e.x_axis_position).draw(),new MG.axis_factory(e).namespace("y").type(e.y_axis_type).zeroLine("categorical"===e.x_axis_type).position(e.y_axis_position).draw(),G.mainPlot(),G.markers(),G.rollover(),G.windowListeners(),G},this.mainPlot=function(){var t=O(M.target),e=M.data[0],r=t.select("g.mg-barplot"),n=r.empty(),a=void 0;n&&M.animate_on_load||M.transition_on_update,M.transition_duration,n&&(r=t.append("g").classed("mg-barplot",!0)),a=r.selectAll(".mg-bar").data(e).enter().append("rect").classed("mg-bar",!0).classed("default-bar",!M.scales.hasOwnProperty("COLOR"));var o=void 0,i=void 0,s=void 0,c=void 0,l=void 0,u=void 0,f=void 0,d=void 0,p=void 0,_=void 0,m=void 0,g=void 0,h=void 0,x=void 0,y=void 0,v=void 0;if("vertical"==M.orientation&&(o="height",i="width",s=M.y_axis_type,c=M.x_axis_type,l="y",u="x",f="categorical"==s?M.scalefns.youtf:M.scalefns.yf,d="categorical"==c?M.scalefns.xoutf:M.scalefns.xf,p=M.scales.Y,_=M.scales.X,m=M.y_accessor,g=M.x_accessor,h=function(t){var e=void 0;return e=f(t),t[m]<0&&(e=p(0)),e},x=function(t){return Math.abs(f(t)-p(0))},y=function(t){return Math.abs(p(t[M.reference_accessor])-p(0))},v=function(t){return p(t[M.reference_accessor])}),"horizontal"==M.orientation&&(o="width",i="height",s=M.x_axis_type,c=M.y_axis_type,l="x",u="y",f="categorical"==s?M.scalefns.xoutf:M.scalefns.xf,d="categorical"==c?M.scalefns.youtf:M.scalefns.yf,p=M.scales.X,_=M.scales.Y,m=M.x_accessor,g=M.y_accessor,h=function(t){return p(0)},x=function(t){return Math.abs(f(t)-p(0))},y=function(t){return Math.abs(p(t[M.reference_accessor])-p(0))},v=function(t){return p(0)}),a.attr(l,h),a.attr(u,function(t){var e=void 0;return"categorical"==c?e=d(t):(e=_(0),t[g]<0&&(e=d(t))),e-=M.bar_thickness/2}),M.scales.COLOR&&a.attr("fill",M.scalefns.colorf),a.attr(o,x).attr(i,function(t){return M.bar_thickness}),null!==M.reference_accessor){var b=e.filter(function(t){return t.hasOwnProperty(M.reference_accessor)});r.selectAll(".mg-categorical-reference").data(b).enter().append("rect").attr(l,v).attr(u,function(t){return d(t)-M.reference_thickness/2}).attr(o,y).attr(i,M.reference_thickness)}if(null!==M.comparison_accessor){var w=null;w=null===M.comparison_thickness?M.bar_thickness/2:M.comparison_thickness;var k=e.filter(function(t){return t.hasOwnProperty(M.comparison_accessor)});r.selectAll(".mg-categorical-comparison").data(k).enter().append("line").attr(l+"1",function(t){return p(t[M.comparison_accessor])}).attr(l+"2",function(t){return p(t[M.comparison_accessor])}).attr(u+"1",function(t){return d(t)-w/2}).attr(u+"2",function(t){return d(t)+w/2}).attr("stroke","black").attr("stroke-width",M.comparison_width)}return(M.legend||null!==M.color_accessor&&M.ygroup_accessor!==M.color_accessor)&&(M.legend_target?function(t){var e=t.legend_target,r=t.orientation,n=t.scales;if(e){var a=E.select(e).append("div").classed("mg-bar-target-legend",!0);("horizontal"==r?n.Y.domain():n.X.domain()).forEach(function(t){var e=a.append("span").classed("mg-bar-target-element",!0);e.append("span").classed("mg-bar-target-legend-shape",!0).style("color",n.COLOR(t)).text("‚óº "),e.append("span").classed("mg-bar-target-legend-text",!0).text(t)})}}(M):function(t,r){var e=void 0;e="horizontal"==r.orientation?r.scales.Y.domain():r.scales.X.domain();var n=0,a=t.append("g").classed("mg-bar-legend",!0).append("text");a.selectAll("*").remove(),a.attr("width",r.right).attr("height",100).attr("text-anchor","start"),e.forEach(function(t){var e=a.append("tspan").attr("x",P(r)).attr("y",r.height/2).attr("dy",1.1*n+"em");e.append("tspan").text("‚ñ† ").attr("fill",r.scales.COLOR(t)).attr("font-size",20),e.append("tspan").text(t).attr("font-weight",300).attr("font-size",10),n++})}(t,M)),G},this.markers=function(){return Lt(M),G},this.rollover=function(){var t=O(M.target);0===t.selectAll(".mg-active-datapoint-container").nodes().length&&S(t,"mg-active-datapoint-container"),t.selectAll(".mg-rollover-rect").remove(),t.selectAll(".mg-active-datapoint").remove();var e=void 0,r=void 0,n=void 0,a=void 0,o=void 0,i=void 0,s=void 0,c=void 0,l=void 0,u=void 0,f=void 0,d=void 0;"vertical"==M.orientation&&(e="height",r="width",n=M.y_axis_type,a=M.x_axis_type,o="y",i="x","categorical"==n?M.scalefns.youtf:M.scalefns.yf,s="categorical"==a?M.scalefns.xoutf:M.scalefns.xf,c=M.scales.Y,l=M.scales.X,M.y_accessor,u=M.x_accessor,f=function(t){return b(M)},d=function(t){return M.height-M.top-M.bottom-2*M.buffer}),"horizontal"==M.orientation&&(e="width",r="height",n=M.x_axis_type,a=M.y_axis_type,o="x",i="y","categorical"==n?M.scalefns.xoutf:M.scalefns.xf,s="categorical"==a?M.scalefns.youtf:M.scalefns.yf,c=M.scales.X,l=M.scales.Y,M.x_accessor,u=M.y_accessor,f=function(t){return c(0)},d=function(t){return M.width-M.left-M.right-2*M.buffer});var p=void 0,_=void 0;_="right"===M.rollover_align?(p=M.width-M.right,"end"):"left"===M.rollover_align?(p=M.left,"start"):(p=(M.width-M.left-M.right)/2+M.left,"middle"),t.append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("x",p).attr("y",.75*M.top).attr("dy",".35em").attr("text-anchor",_);var m=t.append("g").attr("class","mg-rollover-rect").selectAll(".mg-bar-rollover").data(M.data[0]).enter().append("rect").attr("class","mg-bar-rollover");return m.attr("opacity",0).attr(o,f).attr(i,function(t){var e=void 0;return"categorical"==a?e=s(t):(e=l(0),t[u]<0&&(e=s(t))),e-=M.bar_thickness/2}),m.attr(e,d),m.attr(r,function(t){return M.bar_thickness}),m.on("mouseover",G.rolloverOn(M)).on("mouseout",G.rolloverOff(M)).on("mousemove",G.rolloverMove(M)),G},this.rolloverOn=function(o){var i=O(o.target);return G.is_vertical?o.x_accessor:o.y_accessor,G.is_vertical?o.y_accessor:o.x_accessor,G.is_vertical?o.yax_units:o.xax_units,function(t,r){MG.time_format(o.utc_time,"%b %e, %Y"),$e(o);var e=i.selectAll("g.mg-barplot .mg-bar").filter(function(t,e){return e===r}).classed("active",!0);if(o.scales.hasOwnProperty("COLOR")?e.attr("fill",E.rgb(o.scalefns.colorf(t)).darker()):e.classed("default-active",!0),o.show_rollover_text){var n=Ut(o,{svg:i}),a=n.mouseover_row();o.ygroup_accessor&&a.text(t[o.ygroup_accessor]+"   ").bold(),a.text(Le(o,t)),a.text(o.y_accessor+": "+t[o.y_accessor]),(o.predictor_accessor||o.baseline_accessor)&&(a=n.mouseover_row(),o.predictor_accessor&&a.text(je(o,t,null,o.predictor_accessor,!1)),o.baseline_accessor&&a.text(je(o,t,null,o.baseline_accessor,!1)))}o.mouseover&&o.mouseover(t,r)}},this.rolloverOff=function(n){var a=O(n.target);return function(t,e){var r=a.selectAll("g.mg-barplot .mg-bar.active").classed("active",!1);n.scales.hasOwnProperty("COLOR")?r.attr("fill",n.scalefns.colorf(t)):r.classed("default-active",!1),a.select(".mg-active-datapoint").text(""),Xt(a),n.mouseout&&n.mouseout(t,e)}},this.rolloverMove=function(r){return function(t,e){r.mousemove&&r.mousemove(t,e)}},this.windowListeners=function(){return Kt(G.args),G},this.init(M)},{buffer:[16,"number"],y_accessor:["factor","string"],x_accessor:["value","string"],reference_accessor:[null,"string"],comparison_accessor:[null,"string"],secondary_label_accessor:[null,"string"],color_accessor:[null,"string"],color_type:["category",["number","category"]],color_domain:[null,"number[]"],reference_thickness:[1,"number"],comparison_width:[3,"number"],comparison_thickness:[null,"number"],legend:[!1,"boolean"],legend_target:[null,"string"],mouseover_align:["right",["right","left"]],baseline_accessor:[null,"string"],predictor_accessor:[null,"string"],predictor_proportion:[5,"number"],show_bar_zero:[!0,"boolean"],binned:[!0,"boolean"],truncate_x_labels:[!0,"boolean"],truncate_y_labels:[!0,"boolean"]}),MG.data_table=function(t){return this.args=t,this.args.standard_col={width:150,font_size:12,font_weight:"normal"},this.args.columns=[],this.formatting_options=[["color","color"],["font-weight","font_weight"],["font-style","font_style"],["font-size","font_size"]],this._strip_punctuation=function(t){return t.replace(/[^a-zA-Z0-9 _]+/g,"").replace(/ +?/g,"")},this._format_element=function(n,a,o){this.formatting_options.forEach(function(t){var e=t[0],r=t[1];o[r]&&n.style(e,"string"==typeof o[r]||"number"==typeof o[r]?o[r]:o[r](a))})},this._add_column=function(t,e){var r=this.args.standard_col,n=p(MG.clone(t),MG.clone(r));n.type=e,this.args.columns.push(n)},this.target=function(){var t=arguments[0];return this.args.target=t,this},this.title=function(){return this._add_column(arguments[0],"title"),this},this.text=function(){return this._add_column(arguments[0],"text"),this},this.bullet=function(){return this},this.sparkline=function(){return this},this.number=function(){return this._add_column(arguments[0],"number"),this},this.display=function(){var t=this.args;N(t);var e,r,n,a,o,i,s,c,l,u,f,d,p=t.target,_=E.select(p).append("table").classed("mg-data-table",!0),m=_.append("colgroup"),g=_.append("thead"),h=_.append("tbody");for(n=g.append("tr"),d=0;d<t.columns.length;d++){var x=t.columns[d];i=x.type,c=void 0===(c=x.label)?"":c,a=n.append("th").style("width",x.width).style("text-align","title"===i?"left":"right").text(c),t.show_tooltips&&x.description&&k()&&(a.append("i").classed("fa",!0).classed("fa-question-circle",!0).classed("fa-inverse",!0),$(a.node()).popover({html:!0,animation:!1,content:x.description,trigger:"hover",placement:"top",container:$(a.node())}))}for(d=0;d<t.columns.length;d++)f=m.append("col"),"number"===t.columns[d].type&&f.attr("align","char").attr("char",".");for(var y=0;y<t.data.length;y++){n=h.append("tr");for(var v=0;v<t.columns.length;v++){if(o=(e=t.columns[v]).accessor,s=l=t.data[y][o],"number"===(i=e.type)){if(e.hasOwnProperty("round")&&!e.hasOwnProperty("format")&&(l=E.format("0,."+e.round+"f")(l)),e.hasOwnProperty("value_formatter")&&(l=e.value_formatter(l)),e.hasOwnProperty("format")){e.round&&(l=Math.round(l,e.round));var b,w=e.format;"percentage"===w&&(b=E.format(".0%")),"count"===w&&(b=E.format(",.0f")),"temperature"===w&&(b=function(t){return t+"¬∞"}),l=b(l)}e.hasOwnProperty("currency")&&(l=e.currency+l)}u=n.append("td").classed("table-"+i,!0).classed("table-"+i+"-"+this._strip_punctuation(o),!0).attr("data-value",s).style("width",e.width).style("text-align","title"===i||"text"===i?"left":"right"),this._format_element(u,s,e),"title"===i?(r=u.append("div").text(l),this._format_element(r,l,e),t.columns[v].hasOwnProperty("secondary_accessor")&&u.append("div").text(t.data[y][t.columns[v].secondary_accessor]).classed("secondary-title",!0)):u.text(l)}}return this},this};function Ge(t,e){var r,n,a;function o(t){return 1e3===t?3:1e6===t?7:Math.log(t)/Math.LN10}"x"===e?(r=t.x_accessor,n=t.scales.X.ticks(t.xax_count),a=t.processed.max_x):"y"===e&&(r=t.y_accessor,n=t.scales.Y.ticks(t.yax_count),a=t.processed.max_y),("x"===e&&"log"===t.x_scale_type||"y"===e&&"log"===t.y_scale_type)&&(n=n.filter(function(t){return Math.abs(o(t))%1<1e-6||Math.abs(o(t))%1>1-1e-6}));var i=n.length,s=!0;t.data.forEach(function(t,e){t.forEach(function(t,e){if(t[r]%1!=0)return s=!1})}),s&&a<i&&"count"===t.format&&(n=n.filter(function(t){return t%1==0})),"x"===e?t.processed.x_ticks=n:"y"===e&&(t.processed.y_ticks=n)}function Ae(r){if(r.data=MG.clone(r.data),r.single_object=!1,r.array_of_objects=!1,r.array_of_arrays=!1,r.nested_array_of_arrays=!1,r.nested_array_of_objects=!1,n(r.data)?(r.nested_array_of_objects=r.data.map(function(t){return e(t)}),r.nested_array_of_arrays=r.data.map(function(t){return n(t)})):(r.array_of_objects=a(r.data),r.array_of_arrays=n(r.data)),"line"===r.chart_type?(r.array_of_objects||r.array_of_arrays)&&(r.data=[r.data]):T(r.data[0])||(r.data=[r.data]),De(r,"x_accessor"),De(r,"y_accessor"),void 0!==r.color&&(r.colors=r.color),null!==r.colors&&"string"==typeof r.colors&&(r.colors=[r.colors]),"line"===r.chart_type&&!0===r.x_sort)for(var t=0;t<r.data.length;t++)r.data[t].sort(function(t,e){return t[r.x_accessor]-e[r.x_accessor]});return this}function De(e,r){T(e[r])&&(e.data=e.data.map(function(t){return e[r].map(function(e){return t.map(function(t){if(void 0!==(t=MG.clone(t))[e])return t["multiline_"+r]=t[e],t}).filter(function(t){return void 0!==t})})})[0],e[r]="multiline_"+r)}function Oe(r){var t,e=0<E.sum(r.data.map(function(t){return 0<t.length&&C(t[0][r.x_accessor])}));if((r.missing_is_zero||r.missing_is_hidden)&&"line"===r.chart_type&&e)for(var n=0;n<r.data.length;n++)if(!(r.data[n].length<=1)){var a=r.data[n][0],o=r.data[n][r.data[n].length-1],i=[],s=MG.clone(a[r.x_accessor]).setDate(a[r.x_accessor].getDate()+1),c=r.min_x?r.min_x:s,l=r.max_x?r.max_x:o[r.x_accessor];if(t=ft((l-c)/1e3),-1!==["four-days","many-days","many-months","years","default"].indexOf(t)&&null===r.missing_is_hidden_accessor)for(var u=new Date(c);u<=l;u.setDate(u.getDate()+1)){var f={};u.setHours(0,0,0,0),Date.parse(u)===Date.parse(new Date(s))&&i.push(MG.clone(r.data[n][0]));var d=null;r.data[n].forEach(function(t,e){if(Date.parse(t[r.x_accessor])===Date.parse(new Date(u)))return d=t,!1}),d?((d[r.missing_is_hidden_accessor]||null===d[r.y_accessor])&&(d._missing=!0),i.push(d)):(f[r.x_accessor]=new Date(u),f[r.y_accessor]=0,f._missing=!0,i.push(f))}else for(var p=0;p<r.data[n].length;p+=1){var _=MG.clone(r.data[n][p]);_._missing=r.data[n][p][r.missing_is_hidden_accessor],i.push(_)}r.data[n]=i}return this}function ze(e){var t,r=e.data[0];if(!1===e.binned){if("object"===c(r[0]))t=r.map(function(t){return t[e.x_accessor]});else{if("number"!=typeof r[0])return void console.log("TypeError: expected an array of numbers, found "+c(r[0]));t=r}var n=E.histogram();e.bins&&n.thresholds(e.bins);var a=n(t);e.processed_data=a.map(function(t){return{x:t.x0,y:t.length}})}else{var o,i;e.processed_data=r.map(function(t){return{x:t[e.x_accessor],y:t[e.y_accessor]}});for(var s=0;s<e.processed_data.length;s++)o=e.processed_data[s],s===e.processed_data.length-1?o.dx=e.processed_data[s-1].dx:(i=e.processed_data[s+1],o.dx=i.x-o.x)}return e.processed||(e.processed={}),e.processed.original_data=e.data,e.processed.original_x_accessor=e.x_accessor,e.processed.original_y_accessor=e.y_accessor,e.data=[e.processed_data],e.x_accessor=e.processed_x_accessor,e.y_accessor=e.processed_y_accessor,this}function Fe(e){var t=e.data[0],r=t.map(function(t){return t[e.x_accessor]}),n=t.map(function(t){return t[e.y_accessor]});return e.least_squares&&(e.ls_line=Te(r,n)),this}function Ce(e){var t=O(e.target),r=e.data[0],n=E.min(r,function(t){return t[e.x_accessor]}),a=E.max(r,function(t){return t[e.x_accessor]});E.select(e.target).selectAll(".mg-least-squares-line").remove(),t.append("svg:line").attr("x1",e.scales.X(n)).attr("x2",e.scales.X(a)).attr("y1",e.scales.Y(e.ls_line.fit(n))).attr("y2",e.scales.Y(e.ls_line.fit(a))).attr("class","mg-least-squares-line")}function Te(t,e){var r,n,a;t.length;r=C(t[0])?t.map(function(t){return t.getTime()}):t,n=C(e[0])?e.map(function(t){return t.getTime()}):e;for(var o=E.mean(r),i=E.mean(n),s=0,c=0,l=0;l<r.length;l++)s+=((a=r[l])-o)*(n[l]-i),c+=(a-o)*(a-o);var u=s/c,f=i-u*o;return{x0:f,beta:u,fit:function(t){return f+t*u}}}function Re(t,e){return 0<=t&&t<=1?Math.pow(1-Math.pow(t,e),e):0}function Ee(t){var e,r,n,a,o,i,s,c=(n=t,a=E.sum(n.map(function(t){return t.w})),{xbar:E.sum(n.map(function(t){return t.w*t.x}))/a,ybar:E.sum(n.map(function(t){return t.w*t.y}))/a}),l=(o=t,i=r=c.xbar,s=e=c.ybar,E.sum(o.map(function(t){return Math.pow(t.w,2)*(t.x-i)*(t.y-s)}))/E.sum(o.map(function(t){return Math.pow(t.w,2)*Math.pow(t.x-i,2)})));return{beta:l,xbar:r,ybar:e,x0:e-l*r}}function Ye(t,e,r,n,a){var o=Math.floor(t.length*r),i=t.slice();i.sort(function(t,e){return t<e?-1:e<t?1:0});for(var s,c,l,u,f,d=E.quantile(i,.98),p=E.quantile(i,.02),_=E.zip(t,e,a).sort(),m=Math.abs(d-p)/n,g=p,h=d,x=E.range(g,h,m),y=[],v=0;v<x.length;v+=1){c=x[v],s=_.map(function(t){return[Math.abs(t[0]-c),t[0],t[1],t[2]]}).sort().slice(0,o),f=E.max(s)[0];var b=Ee(s=s.map(function(t){return{w:(e=t[0]/f,Re(e,3)*t[3]),x:t[1],y:t[2]};var e}));u=b.x0,l=b.beta,y.push(u+l*c)}return{x:x,y:y}}function $e(n){return"count"===n.format?function(t){var e;return e=t%1!=0?E.format(",."+n.decimals+"f"):E.format(",.0f"),n.yax_units_append?e(t)+n.yax_units:n.yax_units+e(t)}:function(t){var e,r=(e=n.decimals,(!isNaN(parseFloat(e))&&isFinite(e)?"."+n.decimals:"")+"%");return E.format(r)(t)}}MG.register("missing-data",function(t){var R=this;this.init=function(t){bt(R.args=t),wt(t);var e=E.select(t.target);Dt(e,t);var r,n,a,o,i,s,c,l,u,f,d,p,_,m,g,h,x,y,v,b,w,k,M,G,A,D,O,z,F,C=e.selectAll("svg");if(kt(C,t),Gt(C=Mt(C,t),t),At(C,t),r=t.target,E.select(r).selectAll("svg *").remove(),C.classed("mg-missing",!0),(n=t.legend_target)&&E.select(n).html(""),N(t),t.show_missing_background){!function(t){for(var e=[],r=1;r<=50;r++)e.push({x:r,y:Math.random()-.03*r});t.data=e}(t),(G=t).scales.X=E.scaleLinear().domain([0,G.data.length]).range([Y(G),P(G)]),G.scalefns.yf=function(t){var e=t.y;return G.scales.Y(e)},(M=t).scales.Y=E.scaleLinear().domain([-2,2]).range([M.height-M.bottom-2*M.buffer,M.top]),M.scalefns.xf=function(t){var e=t.x;return M.scales.X(e)};var T=S(C,"mg-missing-pane");h=T,y=(x=t).title,v=x.buffer,b=x.title_y_position,w=x.width,k=x.height,h.append("svg:rect").classed("mg-missing-background",!0).attr("x",v).attr("y",v+2*(y?b:0)).attr("width",w-2*v).attr("height",k-2*v-2*(y?b:0)).attr("rx",15).attr("ry",15),f=T,p=(d=t).scalefns,_=d.interpolate,m=d.data,g=E.line().x(p.xf).y(p.yf).curve(_),f.append("path").attr("class","mg-main-line mg-line1-color").attr("d",g(m)),a=T,i=(o=t).scalefns,s=o.scales,c=o.interpolate,l=o.data,u=E.area().x(i.xf).y0(s.Y.range()[0]).y1(i.yf).curve(c),a.append("path").attr("class","mg-main-area mg-area1-color").attr("d",u(l))}return A=C,O=(D=t).missing_text,z=D.width,F=D.height,A.selectAll(".mg-missing-text").data([O]).enter().append("text").attr("class","mg-missing-text").attr("x",z/2).attr("y",F/2).attr("dy",".50em").attr("text-anchor","middle").text(O),R.windowListeners(),R},this.windowListeners=function(){return Kt(R.args),R},this.init(t)},{top:[40,"number"],bottom:[30,"number"],right:[10,"number"],left:[0,"number"],buffer:[8,"number"],legend_target:["","string"],width:[350,"number"],height:[220,"number"],missing_text:["Data currently missing or unavailable","string"],show_tooltips:[!0,"boolean"],show_missing_background:[!0,"boolean"]}),MG.raw_data_transformation=Ae,MG.process_line=Oe,MG.process_histogram=ze,MG.process_categorical_variables=function(t){return"vertical"===t.bar_orientation?t.x_accessor:t.y_accessor,"vertical"===t.bar_orientation?t.y_accessor:t.x_accessor,this},MG.process_point=Fe,MG.add_ls=Ce,MG.add_lowess=function(e){var t=O(e.target),r=e.lowess_line,n=E.svg.line().x(function(t){return e.scales.X(t.x)}).y(function(t){return e.scales.Y(t.y)}).interpolate(e.interpolate);t.append("path").attr("d",n(r)).attr("class","mg-lowess-line")},MG.lowess_robust=function(t,e,r,n){var a,o,i=[];for(E.mean(e),o=0;o<t.length;o+=1)i.push(1);var s=(a=Ye(t,e,r,n,i)).x,c=a.y;for(o=0;o<100;o+=1){i=E.zip(c,e).map(function(t){return Math.abs(t[1]-t[0])});var l=E.quantile(i.sort(),.5);s=(a=Ye(t,e,r,n,i=i.map(function(t){return Re(t/(6*l),2)}))).x,c=a.y}return E.zip(s,c).map(function(t){var e={};return e.x=t[0],e.y=t[1],e})},MG.lowess=function(t,e,r,n){for(var a=[],o=0;o<t.length;o+=1)a.push(1);Ye(t,e,r,n,a)},MG.least_squares=Te;var Pe=function(t,e,r,n){return"string"==typeof t?MG.time_format(n,t)(e[r]):"function"==typeof t?t(e):e[r]},Se=function(t,e,r){return"string"==typeof t?E.format("s")(e[r]):"function"==typeof t?t(e):e[r]};function je(t,e,r,n,a){var o,i=function(t){if(t.rollover_time_format)return MG.time_format(t.utc_time,t.rollover_time_format);switch(t.processed.x_time_frame){case"millis":return MG.time_format(t.utc_time,"%b %e, %Y  %H:%M:%S.%L");case"seconds":return MG.time_format(t.utc_time,"%b %e, %Y  %H:%M:%S");case"less-than-a-day":case"four-days":return MG.time_format(t.utc_time,"%b %e, %Y  %I:%M%p")}return MG.time_format(t.utc_time,"%b %e, %Y")}(t);return o="string"==typeof e[n]?function(t){return t}:$e(t),null!==r?a?Pe(r,e,n,t.utc):Se(r,e,n):a?i(new Date(+e[n]))+"  ":(t.time_series?"":n+": ")+o(e[n])+"   "}function Le(t,e){return je(t,e,t.x_mouseover,t.x_accessor,t.time_series)}function Xe(t,e){return je(t,e,t.y_mouseover,t.y_accessor,!1)}function Ne(c,l){return function(){for(var n=this,a=n.cloneNode(),o=n.getTotalLength()||0,i=(a.setAttribute("d",c),a).getTotalLength()||0,t=[0],e=0,r=l/Math.max(o,i);(e+=r)<1;)t.push(e);t.push(1);var s=t.map(function(t){var e=n.getPointAtLength(t*o),r=a.getPointAtLength(t*i);return E.interpolate([e.x,e.y],[r.x,r.y])});return function(e){return e<1?"M"+s.map(function(t){return t(e)}).join("L"):c}}}function Ue(t){console.error("ERROR : ",t.target," : ",t.error),E.select(t.target).select(".mg-chart-title").append("tspan").attr("class","fa fa-x fa-exclamation-circle mg-warning").attr("dx","0.3em").text("ÔÅ™")}return MG.format_rollover_number=$e,MG.path_tween=Ne,MG.render_markup=function(t){switch("undefined"==typeof window?"undefined":c(window)){case"undefined":return function(t){var e,r=MG.virtual_window,n=E.select(r.document),a=r.document.createElement("div"),o=global.d3,i=global.window,s=global.document;global.d3=n,global.window=r,global.document=r.document;try{t(a)}catch(t){e=t}if(global.d3=o,global.window=i,global.document=s,e)throw e;return n.select(function(){return a}).html()}(t);default:return e=t,r=document.createElement("div"),e(r),E.select(r).html()}var e,r},MG.init_virtual_window=function(t,e){if(!MG.virtual_window||e){var r=t.jsdom({html:"",features:{QuerySelector:!0}});MG.virtual_window=r.defaultView}},MG.error=Ue,MG});